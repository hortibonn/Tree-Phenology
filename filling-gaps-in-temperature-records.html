<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Filling gaps in temperature records | Tree phenology analysis with R</title>
  <meta name="description" content="This lecture introduces the chillR package for R." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Filling gaps in temperature records | Tree phenology analysis with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This lecture introduces the chillR package for R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Filling gaps in temperature records | Tree phenology analysis with R" />
  
  <meta name="twitter:description" content="This lecture introduces the chillR package for R." />
  

<meta name="author" content="Eike Luedeling" />


<meta name="date" content="2024-10-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="get_temp_data.html"/>
<link rel="next" href="generating-temperature-scenarios.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/font-awesome-6.5.2/js/script.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 1em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Tree phenology analysis with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#performance-assessment"><i class="fa fa-check"></i><b>1.2</b> Performance assessment</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#house-rules"><i class="fa fa-check"></i><b>1.3</b> House rules</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-tools-we-use.html"><a href="the-tools-we-use.html"><i class="fa fa-check"></i><b>2</b> The tools we use</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-tools-we-use.html"><a href="the-tools-we-use.html#r-and-rstudio"><i class="fa fa-check"></i><b>2.1</b> R and RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="the-tools-we-use.html"><a href="the-tools-we-use.html#git-and-github"><i class="fa fa-check"></i><b>2.2</b> git and github</a></li>
<li class="chapter" data-level="2.3" data-path="the-tools-we-use.html"><a href="the-tools-we-use.html#rmarkdown"><i class="fa fa-check"></i><b>2.3</b> Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tree-dormancy.html"><a href="tree-dormancy.html"><i class="fa fa-check"></i><b>3</b> Tree dormancy</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tree-dormancy.html"><a href="tree-dormancy.html#learning-goals-for-this-lesson"><i class="fa fa-check"></i><b>3.1</b> Learning goals for this lesson:</a></li>
<li class="chapter" data-level="3.2" data-path="tree-dormancy.html"><a href="tree-dormancy.html#introduction-to-dormancy"><i class="fa fa-check"></i><b>3.2</b> Introduction to dormancy</a></li>
<li class="chapter" data-level="3.3" data-path="tree-dormancy.html"><a href="tree-dormancy.html#dormancy-physiology"><i class="fa fa-check"></i><b>3.3</b> Dormancy physiology</a></li>
<li class="chapter" data-level="3.4" data-path="tree-dormancy.html"><a href="tree-dormancy.html#experimental-and-statistical-determination-of-the-chilling-and-forcing-periods"><i class="fa fa-check"></i><b>3.4</b> Experimental and statistical determination of the chilling and forcing periods</a></li>
<li class="chapter" data-level="3.5" data-path="tree-dormancy.html"><a href="tree-dormancy.html#phenology-record-and-bbch-scale"><i class="fa fa-check"></i><b>3.5</b> Phenology record and BBCH scale</a></li>
<li class="chapter" data-level="" data-path="tree-dormancy.html"><a href="tree-dormancy.html#exercises_dormancy"><i class="fa fa-check"></i><code>Exercises</code> on tree dormancy</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="climate-change-and-impact-projection.html"><a href="climate-change-and-impact-projection.html"><i class="fa fa-check"></i><b>4</b> Climate change and impact projection</a>
<ul>
<li class="chapter" data-level="4.1" data-path="climate-change-and-impact-projection.html"><a href="climate-change-and-impact-projection.html#the-drivers-of-climate-change"><i class="fa fa-check"></i><b>4.1</b> The drivers of climate change</a></li>
<li class="chapter" data-level="4.2" data-path="climate-change-and-impact-projection.html"><a href="climate-change-and-impact-projection.html#what-weve-already-seen"><i class="fa fa-check"></i><b>4.2</b> What we’ve already seen</a></li>
<li class="chapter" data-level="4.3" data-path="climate-change-and-impact-projection.html"><a href="climate-change-and-impact-projection.html#future-scenarios"><i class="fa fa-check"></i><b>4.3</b> Future scenarios</a></li>
<li class="chapter" data-level="4.4" data-path="climate-change-and-impact-projection.html"><a href="climate-change-and-impact-projection.html#impact-projection-approaches"><i class="fa fa-check"></i><b>4.4</b> Impact projection approaches</a></li>
<li class="chapter" data-level="" data-path="climate-change-and-impact-projection.html"><a href="climate-change-and-impact-projection.html#exercises_climate_change"><i class="fa fa-check"></i><code>Exercises</code> on climate change</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html"><i class="fa fa-check"></i><b>5</b> Winter chill projections</a>
<ul>
<li class="chapter" data-level="" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#goals_analysis_examples"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="5.1" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-projections-1"><i class="fa fa-check"></i><b>5.1</b> Winter chill projections</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-in-oman"><i class="fa fa-check"></i><b>5.1.1</b> Winter chill in Oman</a></li>
<li class="chapter" data-level="5.1.2" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#chill-model-sensitivity"><i class="fa fa-check"></i><b>5.1.2</b> Chill model sensitivity</a></li>
<li class="chapter" data-level="5.1.3" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-in-california"><i class="fa fa-check"></i><b>5.1.3</b> Winter chill in California</a></li>
<li class="chapter" data-level="5.1.4" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-ratios"><i class="fa fa-check"></i><b>5.1.4</b> Winter chill ratios</a></li>
<li class="chapter" data-level="5.1.5" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#a-global-projection-of-future-winter-chill"><i class="fa fa-check"></i><b>5.1.5</b> A global projection of future winter chill</a></li>
<li class="chapter" data-level="5.1.6" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-in-germany"><i class="fa fa-check"></i><b>5.1.6</b> Winter chill in Germany</a></li>
<li class="chapter" data-level="5.1.7" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-in-tunisia"><i class="fa fa-check"></i><b>5.1.7</b> Winter chill in Tunisia</a></li>
<li class="chapter" data-level="5.1.8" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#winter-chill-in-chile"><i class="fa fa-check"></i><b>5.1.8</b> Winter chill in Chile</a></li>
<li class="chapter" data-level="5.1.9" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#chill-projection-for-patagonia"><i class="fa fa-check"></i><b>5.1.9</b> Chill projection for Patagonia</a></li>
<li class="chapter" data-level="5.1.10" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#chill-model-comparison"><i class="fa fa-check"></i><b>5.1.10</b> Chill model comparison</a></li>
<li class="chapter" data-level="5.1.11" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#chill-projection-for-all-of-tunisia"><i class="fa fa-check"></i><b>5.1.11</b> Chill projection for all of Tunisia</a></li>
<li class="chapter" data-level="5.1.12" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#revisiting-chill-accumulation-in-oman"><i class="fa fa-check"></i><b>5.1.12</b> Revisiting chill accumulation in Oman</a></li>
<li class="chapter" data-level="5.1.13" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#future-studies"><i class="fa fa-check"></i><b>5.1.13</b> Future studies?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="winter-chill-projections.html"><a href="winter-chill-projections.html#exercises_past_studies"><i class="fa fa-check"></i><code>Exercises</code> on past chill projections</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="manual-chill-analysis.html"><a href="manual-chill-analysis.html"><i class="fa fa-check"></i><b>6</b> Manual chill analysis</a>
<ul>
<li class="chapter" data-level="" data-path="manual-chill-analysis.html"><a href="manual-chill-analysis.html#goals_manual_chill_analysis"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="6.1" data-path="manual-chill-analysis.html"><a href="manual-chill-analysis.html#computing-chilling-hours-from-hourly-temperature-data"><i class="fa fa-check"></i><b>6.1</b> Computing Chilling Hours from hourly temperature data</a></li>
<li class="chapter" data-level="6.2" data-path="manual-chill-analysis.html"><a href="manual-chill-analysis.html#our-first-chill-function"><i class="fa fa-check"></i><b>6.2</b> Our first chill function</a></li>
<li class="chapter" data-level="" data-path="manual-chill-analysis.html"><a href="manual-chill-analysis.html#exercises_manual_chill_analysis"><i class="fa fa-check"></i><code>Exercises</code> on basic chill modeling</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chill-models.html"><a href="chill-models.html"><i class="fa fa-check"></i><b>7</b> Chill models</a>
<ul>
<li class="chapter" data-level="" data-path="chill-models.html"><a href="chill-models.html#goals_chill_models"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="7.1" data-path="chill-models.html"><a href="chill-models.html#chill-models-in-chillr"><i class="fa fa-check"></i><b>7.1</b> Chill models in <code>chillR</code></a></li>
<li class="chapter" data-level="" data-path="chill-models.html"><a href="chill-models.html#exercises_chill_models"><i class="fa fa-check"></i><code>Exercises</code> on chill models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="making-hourly-temperatures.html"><a href="making-hourly-temperatures.html"><i class="fa fa-check"></i><b>8</b> Making hourly temperatures</a>
<ul>
<li class="chapter" data-level="" data-path="making-hourly-temperatures.html"><a href="making-hourly-temperatures.html#goals_hourly"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="8.1" data-path="making-hourly-temperatures.html"><a href="making-hourly-temperatures.html#generating-hourly-temperatures"><i class="fa fa-check"></i><b>8.1</b> Generating hourly temperatures</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="making-hourly-temperatures.html"><a href="making-hourly-temperatures.html#idealized-daily-temperature-curves"><i class="fa fa-check"></i><b>8.1.1</b> Idealized daily temperature curves</a></li>
<li class="chapter" data-level="8.1.2" data-path="making-hourly-temperatures.html"><a href="making-hourly-temperatures.html#empirical-daily-temperature-curves"><i class="fa fa-check"></i><b>8.1.2</b> Empirical daily temperature curves</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="making-hourly-temperatures.html"><a href="making-hourly-temperatures.html#exercises_hourly"><i class="fa fa-check"></i><code>Exercises</code> on hourly temperatures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html"><i class="fa fa-check"></i><b>9</b> Some useful tools in R</a>
<ul>
<li class="chapter" data-level="" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#goals_R_tools"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="9.1" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#an-evolving-language---and-a-lifelong-learning-process"><i class="fa fa-check"></i><b>9.1</b> An evolving language - and a lifelong learning process</a></li>
<li class="chapter" data-level="9.2" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#the-tidyverse"><i class="fa fa-check"></i><b>9.2</b> The <code>tidyverse</code></a></li>
<li class="chapter" data-level="9.3" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#the-ggplot2-package"><i class="fa fa-check"></i><b>9.3</b> The <code>ggplot2</code> package</a></li>
<li class="chapter" data-level="9.4" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#the-tibble-package"><i class="fa fa-check"></i><b>9.4</b> The <code>tibble</code> package</a></li>
<li class="chapter" data-level="9.5" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#the-magrittr-package---pipes"><i class="fa fa-check"></i><b>9.5</b> The <code>magrittr</code> package - pipes</a></li>
<li class="chapter" data-level="9.6" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#the-tidyr-package"><i class="fa fa-check"></i><b>9.6</b> The <code>tidyr</code> package</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#pivot_longer"><i class="fa fa-check"></i><b>9.6.1</b> <code>pivot_longer</code></a></li>
<li class="chapter" data-level="9.6.2" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#pivot_wider"><i class="fa fa-check"></i><b>9.6.2</b> <code>pivot_wider</code></a></li>
<li class="chapter" data-level="9.6.3" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#select"><i class="fa fa-check"></i><b>9.6.3</b> <code>select</code></a></li>
<li class="chapter" data-level="9.6.4" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#filter"><i class="fa fa-check"></i><b>9.6.4</b> <code>filter</code></a></li>
<li class="chapter" data-level="9.6.5" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#mutate"><i class="fa fa-check"></i><b>9.6.5</b> <code>mutate</code></a></li>
<li class="chapter" data-level="9.6.6" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#arrange"><i class="fa fa-check"></i><b>9.6.6</b> <code>arrange</code></a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#loops"><i class="fa fa-check"></i><b>9.7</b> Loops</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#for-loops"><i class="fa fa-check"></i><b>9.7.1</b> <em>For</em> loops</a></li>
<li class="chapter" data-level="9.7.2" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#while-loops"><i class="fa fa-check"></i><b>9.7.2</b> <em>While</em> loops</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#apply-functions"><i class="fa fa-check"></i><b>9.8</b> <code>apply</code> functions</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#sapply"><i class="fa fa-check"></i><b>9.8.1</b> <code>sapply</code></a></li>
<li class="chapter" data-level="9.8.2" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#lapply"><i class="fa fa-check"></i><b>9.8.2</b> <code>lapply</code></a></li>
<li class="chapter" data-level="9.8.3" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#apply"><i class="fa fa-check"></i><b>9.8.3</b> <code>apply</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="some-useful-tools-in-r.html"><a href="some-useful-tools-in-r.html#exercises_R_tools"><i class="fa fa-check"></i><code>Exercises</code> on useful R tools</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="get_temp_data.html"><a href="get_temp_data.html"><i class="fa fa-check"></i><b>10</b> Getting temperature data</a>
<ul>
<li class="chapter" data-level="" data-path="get_temp_data.html"><a href="get_temp_data.html#goals_get_temps"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="10.1" data-path="get_temp_data.html"><a href="get_temp_data.html#temperature-data-needs"><i class="fa fa-check"></i><b>10.1</b> Temperature data needs</a></li>
<li class="chapter" data-level="10.2" data-path="get_temp_data.html"><a href="get_temp_data.html#the-global-summary-of-the-day-database"><i class="fa fa-check"></i><b>10.2</b> The Global Summary of the Day database</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="get_temp_data.html"><a href="get_temp_data.html#actionlist_stations"><i class="fa fa-check"></i><b>10.2.1</b> <code>action=list_stations</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="get_temp_data.html"><a href="get_temp_data.html#actiondownload_weather"><i class="fa fa-check"></i><b>10.2.2</b> <code>action="download_weather"</code></a></li>
<li class="chapter" data-level="10.2.3" data-path="get_temp_data.html"><a href="get_temp_data.html#downloaded-weather-as-action-argument"><i class="fa fa-check"></i><b>10.2.3</b> downloaded weather as <code>action</code> argument</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="get_temp_data.html"><a href="get_temp_data.html#exercises_getting"><i class="fa fa-check"></i><code>Exercises</code> on getting temperature data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html"><i class="fa fa-check"></i><b>11</b> Filling gaps in temperature records</a>
<ul>
<li class="chapter" data-level="" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#goals_gaps"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="11.1" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#gaps"><i class="fa fa-check"></i><b>11.1</b> Gaps</a></li>
<li class="chapter" data-level="11.2" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#filling-short-gaps-in-daily-records"><i class="fa fa-check"></i><b>11.2</b> Filling short gaps in daily records</a></li>
<li class="chapter" data-level="11.3" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#filling-long-gaps-in-daily-records"><i class="fa fa-check"></i><b>11.3</b> Filling long gaps in daily records</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#bias-correction-for-shorter-intervals"><i class="fa fa-check"></i><b>11.3.1</b> Bias-correction for shorter intervals</a></li>
<li class="chapter" data-level="11.3.2" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#saving-the-data-for-later"><i class="fa fa-check"></i><b>11.3.2</b> Saving the data for later</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#filling-gaps-in-hourly-records"><i class="fa fa-check"></i><b>11.4</b> Filling gaps in hourly records</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#accuracy-assessment"><i class="fa fa-check"></i><b>11.4.1</b> Accuracy assessment</a></li>
<li class="chapter" data-level="11.4.2" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#computing-agroclimatic-metrics"><i class="fa fa-check"></i><b>11.4.2</b> Computing agroclimatic metrics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="filling-gaps-in-temperature-records.html"><a href="filling-gaps-in-temperature-records.html#exercises_patching"><i class="fa fa-check"></i><code>Exercises</code> on filling gaps</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html"><i class="fa fa-check"></i><b>12</b> Generating temperature scenarios</a>
<ul>
<li class="chapter" data-level="" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html#goals_temperature_scenarios"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="12.1" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html#chill-scenarios"><i class="fa fa-check"></i><b>12.1</b> Chill scenarios</a></li>
<li class="chapter" data-level="12.2" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html#risk-assessment-in-orchard-planning"><i class="fa fa-check"></i><b>12.2</b> Risk assessment in orchard planning</a></li>
<li class="chapter" data-level="12.3" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html#weather-generators"><i class="fa fa-check"></i><b>12.3</b> Weather generators</a></li>
<li class="chapter" data-level="12.4" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html#weather-generation-in-chillr"><i class="fa fa-check"></i><b>12.4</b> Weather generation in <code>chillR</code></a></li>
<li class="chapter" data-level="" data-path="generating-temperature-scenarios.html"><a href="generating-temperature-scenarios.html#weather_generation_exercises"><i class="fa fa-check"></i><code>Exercises</code> on temperature generation</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="saving-and-loading-data-and-hiding-this-in-markdown.html"><a href="saving-and-loading-data-and-hiding-this-in-markdown.html"><i class="fa fa-check"></i><b>13</b> Saving and loading data (and hiding this in markdown)</a>
<ul>
<li class="chapter" data-level="13.1" data-path="saving-and-loading-data-and-hiding-this-in-markdown.html"><a href="saving-and-loading-data-and-hiding-this-in-markdown.html#learning-goals-for-this-lesson-1"><i class="fa fa-check"></i><b>13.1</b> Learning Goals for this lesson:</a></li>
<li class="chapter" data-level="13.2" data-path="saving-and-loading-data-and-hiding-this-in-markdown.html"><a href="saving-and-loading-data-and-hiding-this-in-markdown.html#saving-and-loading-data"><i class="fa fa-check"></i><b>13.2</b> Saving and loading data</a></li>
<li class="chapter" data-level="13.3" data-path="saving-and-loading-data-and-hiding-this-in-markdown.html"><a href="saving-and-loading-data-and-hiding-this-in-markdown.html#hiding-all-this-from-the-readers-of-our-markdown-file"><i class="fa fa-check"></i><b>13.3</b> Hiding all this from the readers of our markdown file</a></li>
<li class="chapter" data-level="" data-path="saving-and-loading-data-and-hiding-this-in-markdown.html"><a href="saving-and-loading-data-and-hiding-this-in-markdown.html#exercises_saveLoad"><i class="fa fa-check"></i><code>Exercises</code> on saving and loading data</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="historic-temperature-scenarios.html"><a href="historic-temperature-scenarios.html"><i class="fa fa-check"></i><b>14</b> Historic temperature scenarios</a>
<ul>
<li class="chapter" data-level="" data-path="historic-temperature-scenarios.html"><a href="historic-temperature-scenarios.html#goals_hist_temp_scen"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="14.1" data-path="historic-temperature-scenarios.html"><a href="historic-temperature-scenarios.html#climate-change-scenarios"><i class="fa fa-check"></i><b>14.1</b> Climate change scenarios</a></li>
<li class="chapter" data-level="14.2" data-path="historic-temperature-scenarios.html"><a href="historic-temperature-scenarios.html#making-historic-temperature-scenarios"><i class="fa fa-check"></i><b>14.2</b> Making historic temperature scenarios</a></li>
<li class="chapter" data-level="" data-path="historic-temperature-scenarios.html"><a href="historic-temperature-scenarios.html#exercises_historic_scenarios"><i class="fa fa-check"></i><code>Exercises</code> on generating historic temperature scenarios</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="future-temperature-scenarios.html"><a href="future-temperature-scenarios.html"><i class="fa fa-check"></i><b>15</b> Future temperature scenarios</a>
<ul>
<li class="chapter" data-level="" data-path="future-temperature-scenarios.html"><a href="future-temperature-scenarios.html#goals_future_temp_scen"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="15.1" data-path="future-temperature-scenarios.html"><a href="future-temperature-scenarios.html#impacts-of-future-climate-change"><i class="fa fa-check"></i><b>15.1</b> Impacts of future climate change</a></li>
<li class="chapter" data-level="15.2" data-path="future-temperature-scenarios.html"><a href="future-temperature-scenarios.html#future-climate-scenarios"><i class="fa fa-check"></i><b>15.2</b> Future climate scenarios</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="future-temperature-scenarios.html"><a href="future-temperature-scenarios.html#some-background-on-climate-models-and-warming-pathways"><i class="fa fa-check"></i><b>15.2.1</b> Some background on climate models and warming pathways</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="future-temperature-scenarios.html"><a href="future-temperature-scenarios.html#exercises_future_scenarios"><i class="fa fa-check"></i><code>Exercises</code> on future temperature scenarios</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html"><i class="fa fa-check"></i><b>16</b> Making CMIP6 scenarios</a>
<ul>
<li class="chapter" data-level="" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#goals_CMIP6"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="16.1" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#accessing-gridded-climate-data-from-the-copernicus-climate-data-store"><i class="fa fa-check"></i><b>16.1</b> Accessing gridded climate data from the Copernicus climate data store</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#downloading-future-climate-data"><i class="fa fa-check"></i><b>16.1.1</b> Downloading future climate data</a></li>
<li class="chapter" data-level="16.1.2" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#generating-change-scenarios"><i class="fa fa-check"></i><b>16.1.2</b> Generating change scenarios</a></li>
<li class="chapter" data-level="16.1.3" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#extracting-data-from-the-grids"><i class="fa fa-check"></i><b>16.1.3</b> Extracting data from the grids</a></li>
<li class="chapter" data-level="16.1.4" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#baseline-adjustment"><i class="fa fa-check"></i><b>16.1.4</b> Baseline adjustment</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="making-cmip6-scenarios.html"><a href="making-cmip6-scenarios.html#exercises_CMIP6"><i class="fa fa-check"></i><code>Exercises</code> on generating CMIP6 temperature scenarios</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="making-cmip5-scenarios-with-the-climatewizard.html"><a href="making-cmip5-scenarios-with-the-climatewizard.html"><i class="fa fa-check"></i><b>17</b> Making CMIP5 scenarios with the <code>ClimateWizard</code></a>
<ul>
<li class="chapter" data-level="" data-path="making-cmip5-scenarios-with-the-climatewizard.html"><a href="making-cmip5-scenarios-with-the-climatewizard.html#goals_ClimateWizard"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="17.1" data-path="making-cmip5-scenarios-with-the-climatewizard.html"><a href="making-cmip5-scenarios-with-the-climatewizard.html#using-the-climatewizard"><i class="fa fa-check"></i><b>17.1</b> Using the <code>ClimateWizard</code></a></li>
<li class="chapter" data-level="" data-path="making-cmip5-scenarios-with-the-climatewizard.html"><a href="making-cmip5-scenarios-with-the-climatewizard.html#exercises_ClimateWizard"><i class="fa fa-check"></i><code>Exercises</code> on generating CMIP5 temperature scenarios</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="plot_future.html"><a href="plot_future.html"><i class="fa fa-check"></i><b>18</b> Plotting future scenarios</a>
<ul>
<li class="chapter" data-level="" data-path="plot_future.html"><a href="plot_future.html#goals_future_plots"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="18.1" data-path="plot_future.html"><a href="plot_future.html#making-attractive-plots"><i class="fa fa-check"></i><b>18.1</b> Making attractive plots</a></li>
<li class="chapter" data-level="18.2" data-path="plot_future.html"><a href="plot_future.html#the-results"><i class="fa fa-check"></i><b>18.2</b> The results</a></li>
<li class="chapter" data-level="" data-path="plot_future.html"><a href="plot_future.html#exercises_future_plots"><i class="fa fa-check"></i><code>Exercises</code> on plotting future projections</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="chill_model_comparison.html"><a href="chill_model_comparison.html"><i class="fa fa-check"></i><b>19</b> Chill model comparison</a>
<ul>
<li class="chapter" data-level="" data-path="chill_model_comparison.html"><a href="chill_model_comparison.html#goals_chill_model"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="19.1" data-path="chill_model_comparison.html"><a href="chill_model_comparison.html#safe-winter-chill"><i class="fa fa-check"></i><b>19.1</b> Safe Winter Chill</a></li>
<li class="chapter" data-level="19.2" data-path="chill_model_comparison.html"><a href="chill_model_comparison.html#chill-metrics"><i class="fa fa-check"></i><b>19.2</b> Chill metrics</a></li>
<li class="chapter" data-level="19.3" data-path="chill_model_comparison.html"><a href="chill_model_comparison.html#an-animated-plot-of-relative-changes-in-safe-winter-chill"><i class="fa fa-check"></i><b>19.3</b> An animated plot of relative changes in Safe Winter Chill</a></li>
<li class="chapter" data-level="" data-path="chill_model_comparison.html"><a href="chill_model_comparison.html#exercises_chill_model_comparison"><i class="fa fa-check"></i><code>Exercises</code> on chill model comparison</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="simple_phenology.html"><a href="simple_phenology.html"><i class="fa fa-check"></i><b>20</b> Simple phenology analysis</a>
<ul>
<li class="chapter" data-level="" data-path="simple_phenology.html"><a href="simple_phenology.html#goals_simple_phenology"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="20.1" data-path="simple_phenology.html"><a href="simple_phenology.html#phenology-analysis"><i class="fa fa-check"></i><b>20.1</b> Phenology analysis</a></li>
<li class="chapter" data-level="20.2" data-path="simple_phenology.html"><a href="simple_phenology.html#time-series-analysis"><i class="fa fa-check"></i><b>20.2</b> Time series analysis</a></li>
<li class="chapter" data-level="20.3" data-path="simple_phenology.html"><a href="simple_phenology.html#p-hacking"><i class="fa fa-check"></i><b>20.3</b> p-hacking</a></li>
<li class="chapter" data-level="20.4" data-path="simple_phenology.html"><a href="simple_phenology.html#the-process-that-generates-the-data"><i class="fa fa-check"></i><b>20.4</b> The process that generates the data</a></li>
<li class="chapter" data-level="20.5" data-path="simple_phenology.html"><a href="simple_phenology.html#an-ecological-theory-to-guide-our-analysis"><i class="fa fa-check"></i><b>20.5</b> An ecological theory to guide our analysis</a></li>
<li class="chapter" data-level="20.6" data-path="simple_phenology.html"><a href="simple_phenology.html#temperature-correlations"><i class="fa fa-check"></i><b>20.6</b> Temperature correlations</a></li>
<li class="chapter" data-level="" data-path="simple_phenology.html"><a href="simple_phenology.html#exercises_simple_analysis"><i class="fa fa-check"></i><code>Exercises</code> on simple phenology analysis</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="pls_intro.html"><a href="pls_intro.html"><i class="fa fa-check"></i><b>21</b> Delineating temperature response phases with PLS regression</a>
<ul>
<li class="chapter" data-level="" data-path="pls_intro.html"><a href="pls_intro.html#goals_PLS_intro"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="21.1" data-path="pls_intro.html"><a href="pls_intro.html#detecting-temperature-response-phases"><i class="fa fa-check"></i><b>21.1</b> Detecting temperature response phases</a></li>
<li class="chapter" data-level="21.2" data-path="pls_intro.html"><a href="pls_intro.html#finding-signals-in-hyperspectral-remote-sensing-data"><i class="fa fa-check"></i><b>21.2</b> Finding signals in hyperspectral remote sensing data</a></li>
<li class="chapter" data-level="21.3" data-path="pls_intro.html"><a href="pls_intro.html#pls-regression-for-phenology-analysis"><i class="fa fa-check"></i><b>21.3</b> PLS regression for phenology analysis</a></li>
<li class="chapter" data-level="21.4" data-path="pls_intro.html"><a href="pls_intro.html#a-note-of-caution-about-pls-results"><i class="fa fa-check"></i><b>21.4</b> A note of caution about PLS results</a></li>
<li class="chapter" data-level="21.5" data-path="pls_intro.html"><a href="pls_intro.html#pls-analysis-of-alexander-lucas-pears-in-klein-altendorf"><i class="fa fa-check"></i><b>21.5</b> PLS analysis of ‘Alexander Lucas’ pears in Klein-Altendorf</a></li>
<li class="chapter" data-level="" data-path="pls_intro.html"><a href="pls_intro.html#exercises_first_PLS"><i class="fa fa-check"></i><code>Exercises</code> on chill model comparison</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="pls_reflection.html"><a href="pls_reflection.html"><i class="fa fa-check"></i><b>22</b> Successes and limitations of PLS regression analysis</a>
<ul>
<li class="chapter" data-level="" data-path="pls_reflection.html"><a href="pls_reflection.html#goals_PLS_reflection"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="22.1" data-path="pls_reflection.html"><a href="pls_reflection.html#pls-regression"><i class="fa fa-check"></i><b>22.1</b> PLS regression</a></li>
<li class="chapter" data-level="22.2" data-path="pls_reflection.html"><a href="pls_reflection.html#pls-examples"><i class="fa fa-check"></i><b>22.2</b> PLS examples</a>
<ul>
<li class="chapter" data-level="22.2.1" data-path="pls_reflection.html"><a href="pls_reflection.html#grasslands-on-the-tibetan-plateau"><i class="fa fa-check"></i><b>22.2.1</b> Grasslands on the Tibetan Plateau</a></li>
<li class="chapter" data-level="22.2.2" data-path="pls_reflection.html"><a href="pls_reflection.html#deciduous-trees"><i class="fa fa-check"></i><b>22.2.2</b> Deciduous trees</a></li>
<li class="chapter" data-level="22.2.3" data-path="pls_reflection.html"><a href="pls_reflection.html#why-were-not-seeing-the-chilling-phase"><i class="fa fa-check"></i><b>22.2.3</b> Why we’re not seeing the chilling phase</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pls_reflection.html"><a href="pls_reflection.html#exercises_PLS_reflection"><i class="fa fa-check"></i><code>Exercises</code> on chill model comparison</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="pls_chillforce.html"><a href="pls_chillforce.html"><i class="fa fa-check"></i><b>23</b> PLS regression with agroclimatic metrics</a>
<ul>
<li class="chapter" data-level="" data-path="pls_chillforce.html"><a href="pls_chillforce.html#goals_PLS_chillforce"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="23.1" data-path="pls_chillforce.html"><a href="pls_chillforce.html#adjusting-pls-for-use-with-non-monotonic-relationships"><i class="fa fa-check"></i><b>23.1</b> Adjusting PLS for use with non-monotonic relationships</a></li>
<li class="chapter" data-level="23.2" data-path="pls_chillforce.html"><a href="pls_chillforce.html#pls-analysis-with-chilling-and-forcing-data"><i class="fa fa-check"></i><b>23.2</b> PLS analysis with chilling and forcing data</a></li>
<li class="chapter" data-level="23.3" data-path="pls_chillforce.html"><a href="pls_chillforce.html#delineating-chilling-and-forcing-periods"><i class="fa fa-check"></i><b>23.3</b> Delineating chilling and forcing periods</a></li>
<li class="chapter" data-level="23.4" data-path="pls_chillforce.html"><a href="pls_chillforce.html#ggplotting-the-results"><i class="fa fa-check"></i><b>23.4</b> <code>ggplot</code>ting the results</a></li>
<li class="chapter" data-level="" data-path="pls_chillforce.html"><a href="pls_chillforce.html#exercises_PLS_chill_force"><i class="fa fa-check"></i><code>Exercises</code> on chill model comparison</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html"><i class="fa fa-check"></i><b>24</b> Examples of PLS regression with agroclimatic metrics</a>
<ul>
<li class="chapter" data-level="" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#goals_PLS_chillforce_ex"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="24.1" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#pls-regression-across-species-and-agroclimatic-contexts"><i class="fa fa-check"></i><b>24.1</b> PLS regression across species and agroclimatic contexts</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#chestnut-jujube-and-apricot-in-beijing"><i class="fa fa-check"></i><b>24.1.1</b> Chestnut, jujube and apricot in Beijing</a></li>
<li class="chapter" data-level="24.1.2" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#apples-in-shaanxi-province-china"><i class="fa fa-check"></i><b>24.1.2</b> Apples in Shaanxi Province, China</a></li>
<li class="chapter" data-level="24.1.3" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#cherries-in-klein-altendorf"><i class="fa fa-check"></i><b>24.1.3</b> Cherries in Klein-Altendorf</a></li>
<li class="chapter" data-level="24.1.4" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#apricots-in-the-uk"><i class="fa fa-check"></i><b>24.1.4</b> Apricots in the UK</a></li>
<li class="chapter" data-level="24.1.5" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#grapevine-in-croatia"><i class="fa fa-check"></i><b>24.1.5</b> Grapevine in Croatia</a></li>
<li class="chapter" data-level="24.1.6" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#walnuts-in-california"><i class="fa fa-check"></i><b>24.1.6</b> Walnuts in California</a></li>
<li class="chapter" data-level="24.1.7" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#almonds-in-tunisia"><i class="fa fa-check"></i><b>24.1.7</b> Almonds in Tunisia</a></li>
<li class="chapter" data-level="24.1.8" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#pistachios-in-tunisia"><i class="fa fa-check"></i><b>24.1.8</b> Pistachios in Tunisia</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pls_chillforce_ex.html"><a href="pls_chillforce_ex.html#exercises_PLS_chill_force_ex"><i class="fa fa-check"></i><code>Exercises</code> on examples of PLS regression with agroclimatic metrics</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html"><i class="fa fa-check"></i><b>25</b> Why PLS doesn’t always work</a>
<ul>
<li class="chapter" data-level="" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#goals_PLS_chillforce_reflection"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="25.1" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#disappointing-pls-performance"><i class="fa fa-check"></i><b>25.1</b> Disappointing PLS performance</a></li>
<li class="chapter" data-level="25.2" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#what-pls-regression-can-find"><i class="fa fa-check"></i><b>25.2</b> What PLS regression can find</a></li>
<li class="chapter" data-level="25.3" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#chill-model-sensitivity-vs.-observed-temperature"><i class="fa fa-check"></i><b>25.3</b> Chill model sensitivity vs. observed temperature</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#beijing-china"><i class="fa fa-check"></i><b>25.3.1</b> Beijing, China</a></li>
<li class="chapter" data-level="25.3.2" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#klein-altendorf-germany"><i class="fa fa-check"></i><b>25.3.2</b> Klein-Altendorf, Germany</a></li>
<li class="chapter" data-level="25.3.3" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#davis-california"><i class="fa fa-check"></i><b>25.3.3</b> Davis, California</a></li>
<li class="chapter" data-level="25.3.4" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#sfax-tunisia"><i class="fa fa-check"></i><b>25.3.4</b> Sfax, Tunisia</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#heat-model-sensitivity-vs.-observed-temperature"><i class="fa fa-check"></i><b>25.4</b> Heat model sensitivity vs. observed temperature</a></li>
<li class="chapter" data-level="" data-path="pls_chillforce_reflection.html"><a href="pls_chillforce_reflection.html#exercises_PLS_chillforce_reflection"><i class="fa fa-check"></i><code>Exercises</code> on expected PLS responsiveness</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="pls_eval_PLS.html"><a href="pls_eval_PLS.html"><i class="fa fa-check"></i><b>26</b> Evaluating PLS outputs</a>
<ul>
<li class="chapter" data-level="" data-path="pls_eval_PLS.html"><a href="pls_eval_PLS.html#goals_PLS_eval"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="26.1" data-path="pls_eval_PLS.html"><a href="pls_eval_PLS.html#chilling-and-forcing-requirements"><i class="fa fa-check"></i><b>26.1</b> Chilling and forcing requirements</a></li>
<li class="chapter" data-level="26.2" data-path="pls_eval_PLS.html"><a href="pls_eval_PLS.html#response-to-seasonal-temperature"><i class="fa fa-check"></i><b>26.2</b> Response to seasonal temperature</a></li>
<li class="chapter" data-level="26.3" data-path="pls_eval_PLS.html"><a href="pls_eval_PLS.html#applying-our-functions-to-california-walnuts"><i class="fa fa-check"></i><b>26.3</b> Applying our functions to California walnuts</a></li>
<li class="chapter" data-level="" data-path="pls_eval_PLS.html"><a href="pls_eval_PLS.html#exercises_PLS_eval"><i class="fa fa-check"></i><code>Exercises</code> on evaluating PLS regression results</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html"><i class="fa fa-check"></i><b>27</b> The relative importance of chill and heat</a>
<ul>
<li class="chapter" data-level="" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html#goals_PLS_chillforce_relimp"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="27.1" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html#chilling-vs.-forcing-temperatures"><i class="fa fa-check"></i><b>27.1</b> Chilling vs. forcing temperatures</a></li>
<li class="chapter" data-level="27.2" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html#patterns-in-temperature-responses"><i class="fa fa-check"></i><b>27.2</b> Patterns in temperature responses</a></li>
<li class="chapter" data-level="27.3" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html#the-warm-end-of-the-spectrum"><i class="fa fa-check"></i><b>27.3</b> The warm end of the spectrum</a></li>
<li class="chapter" data-level="27.4" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html#implications-of-our-hypothesis"><i class="fa fa-check"></i><b>27.4</b> Implications of our hypothesis</a></li>
<li class="chapter" data-level="" data-path="pls_chillforce_relimp.html"><a href="pls_chillforce_relimp.html#exercises_PLS_chillforce_relimp"><i class="fa fa-check"></i><code>Exercises</code> on the relative importance of chill and heat</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="exp_PLS.html"><a href="exp_PLS.html"><i class="fa fa-check"></i><b>28</b> Experimentally enhanced PLS</a>
<ul>
<li class="chapter" data-level="" data-path="exp_PLS.html"><a href="exp_PLS.html#goals_exp_PLS"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="28.1" data-path="exp_PLS.html"><a href="exp_PLS.html#enhanced-phenology-data"><i class="fa fa-check"></i><b>28.1</b> Enhanced phenology data</a></li>
<li class="chapter" data-level="" data-path="exp_PLS.html"><a href="exp_PLS.html#exc_exp_PLS"><i class="fa fa-check"></i><code>Exercises</code> on experimental PLS</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="model_validity.html"><a href="model_validity.html"><i class="fa fa-check"></i><b>29</b> Making valid tree phenology models</a>
<ul>
<li class="chapter" data-level="" data-path="model_validity.html"><a href="model_validity.html#goals_model_validity"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="29.1" data-path="model_validity.html"><a href="model_validity.html#the-modeling-challenge"><i class="fa fa-check"></i><b>29.1</b> The modeling challenge</a></li>
<li class="chapter" data-level="29.2" data-path="model_validity.html"><a href="model_validity.html#validating-models"><i class="fa fa-check"></i><b>29.2</b> Validating models</a></li>
<li class="chapter" data-level="29.3" data-path="model_validity.html"><a href="model_validity.html#mapping-validity-domains"><i class="fa fa-check"></i><b>29.3</b> Mapping validity domains</a></li>
<li class="chapter" data-level="29.4" data-path="model_validity.html"><a href="model_validity.html#one-last-thought-on-model-validity"><i class="fa fa-check"></i><b>29.4</b> One last thought on model validity</a></li>
<li class="chapter" data-level="" data-path="model_validity.html"><a href="model_validity.html#ex_model_validity"><i class="fa fa-check"></i><code>Exercises</code> on making valid tree phenology models</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="phenoflex.html"><a href="phenoflex.html"><i class="fa fa-check"></i><b>30</b> The <code>PhenoFlex</code> model</a>
<ul>
<li class="chapter" data-level="" data-path="phenoflex.html"><a href="phenoflex.html#goals_phenoflex"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="30.1" data-path="phenoflex.html"><a href="phenoflex.html#ingredients-of-this-lesson"><i class="fa fa-check"></i><b>30.1</b> Ingredients of this lesson</a></li>
<li class="chapter" data-level="30.2" data-path="phenoflex.html"><a href="phenoflex.html#towards-credible-phenology-models"><i class="fa fa-check"></i><b>30.2</b> Towards credible phenology models</a></li>
<li class="chapter" data-level="30.3" data-path="phenoflex.html"><a href="phenoflex.html#the-phenoflex-framework"><i class="fa fa-check"></i><b>30.3</b> The PhenoFlex framework</a></li>
<li class="chapter" data-level="30.4" data-path="phenoflex.html"><a href="phenoflex.html#running-phenoflex"><i class="fa fa-check"></i><b>30.4</b> Running <code>PhenoFlex</code></a></li>
<li class="chapter" data-level="30.5" data-path="phenoflex.html"><a href="phenoflex.html#parameterizing-phenoflex"><i class="fa fa-check"></i><b>30.5</b> Parameterizing <code>PhenoFlex</code></a></li>
<li class="chapter" data-level="30.6" data-path="phenoflex.html"><a href="phenoflex.html#conclusions-on-phenoflex"><i class="fa fa-check"></i><b>30.6</b> Conclusions on <code>PhenoFlex</code></a></li>
<li class="chapter" data-level="" data-path="phenoflex.html"><a href="phenoflex.html#ex_model_phenoflex"><i class="fa fa-check"></i><code>Exercises</code> on making valid tree phenology models</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="phenoflex2.html"><a href="phenoflex2.html"><i class="fa fa-check"></i><b>31</b> The <code>PhenoFlex</code> model - a second look</a>
<ul>
<li class="chapter" data-level="" data-path="phenoflex2.html"><a href="phenoflex2.html#goals_phenoflex2"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="31.1" data-path="phenoflex2.html"><a href="phenoflex2.html#some-basic-diagnostics-for-our-phenoflex-fit"><i class="fa fa-check"></i><b>31.1</b> Some basic diagnostics for our <code>PhenoFlex</code> fit</a></li>
<li class="chapter" data-level="31.2" data-path="phenoflex2.html"><a href="phenoflex2.html#temperature-response-of-the-phenoflex-components"><i class="fa fa-check"></i><b>31.2</b> Temperature response of the <code>PhenoFlex</code> components</a></li>
<li class="chapter" data-level="31.3" data-path="phenoflex2.html"><a href="phenoflex2.html#overall-impression"><i class="fa fa-check"></i><b>31.3</b> Overall impression</a></li>
<li class="chapter" data-level="31.4" data-path="phenoflex2.html"><a href="phenoflex2.html#caveats-and-assumptions"><i class="fa fa-check"></i><b>31.4</b> Caveats and assumptions</a></li>
<li class="chapter" data-level="31.5" data-path="phenoflex2.html"><a href="phenoflex2.html#outlook"><i class="fa fa-check"></i><b>31.5</b> Outlook</a></li>
<li class="chapter" data-level="" data-path="phenoflex2.html"><a href="phenoflex2.html#ex_phenoflex2"><i class="fa fa-check"></i><code>Exercises</code> on basic <code>PhenoFlex</code> diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="phenoflex3.html"><a href="phenoflex3.html"><i class="fa fa-check"></i><b>32</b> Can we improve the performance of <code>PhenoFlex</code>?</a>
<ul>
<li class="chapter" data-level="" data-path="phenoflex3.html"><a href="phenoflex3.html#goals_phenoflex3"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="32.1" data-path="phenoflex3.html"><a href="phenoflex3.html#the-motivation"><i class="fa fa-check"></i><b>32.1</b> The motivation</a></li>
<li class="chapter" data-level="32.2" data-path="phenoflex3.html"><a href="phenoflex3.html#using-experimental-phenology-data-for-assessing-the-performance-of-phenoflex"><i class="fa fa-check"></i><b>32.2</b> Using experimental phenology data for assessing the performance of <code>PhenoFlex</code></a></li>
<li class="chapter" data-level="32.3" data-path="phenoflex3.html"><a href="phenoflex3.html#validation"><i class="fa fa-check"></i><b>32.3</b> Validation</a></li>
<li class="chapter" data-level="32.4" data-path="phenoflex3.html"><a href="phenoflex3.html#conclusions"><i class="fa fa-check"></i><b>32.4</b> Conclusions</a></li>
<li class="chapter" data-level="" data-path="phenoflex3.html"><a href="phenoflex3.html#ex_phenoflex3"><i class="fa fa-check"></i><code>Exercises</code> on improving the performance of <code>PhenoFlex</code></a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="frost-risk-analysis.html"><a href="frost-risk-analysis.html"><i class="fa fa-check"></i><b>33</b> Frost risk analysis</a>
<ul>
<li class="chapter" data-level="" data-path="frost-risk-analysis.html"><a href="frost-risk-analysis.html#goals_frost_risk"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="33.1" data-path="frost-risk-analysis.html"><a href="frost-risk-analysis.html#spring-frost"><i class="fa fa-check"></i><b>33.1</b> Spring frost</a></li>
<li class="chapter" data-level="33.2" data-path="frost-risk-analysis.html"><a href="frost-risk-analysis.html#phenology-trend-analysis"><i class="fa fa-check"></i><b>33.2</b> Phenology trend analysis</a></li>
<li class="chapter" data-level="33.3" data-path="frost-risk-analysis.html"><a href="frost-risk-analysis.html#frost-risk"><i class="fa fa-check"></i><b>33.3</b> Frost risk</a></li>
<li class="chapter" data-level="" data-path="frost-risk-analysis.html"><a href="frost-risk-analysis.html#exercises_frost_risk"><i class="fa fa-check"></i><code>Exercises</code> on frost risk analysis</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="a-robust-method-to-estimate-future-frost-risks.html"><a href="a-robust-method-to-estimate-future-frost-risks.html"><i class="fa fa-check"></i><b>34</b> A robust method to estimate future frost risks (?)</a>
<ul>
<li class="chapter" data-level="" data-path="a-robust-method-to-estimate-future-frost-risks.html"><a href="a-robust-method-to-estimate-future-frost-risks.html#goals_future_frost_risk"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="34.1" data-path="a-robust-method-to-estimate-future-frost-risks.html"><a href="a-robust-method-to-estimate-future-frost-risks.html#frost-risk-for-future-scenarios"><i class="fa fa-check"></i><b>34.1</b> Frost risk for future scenarios</a></li>
<li class="chapter" data-level="34.2" data-path="a-robust-method-to-estimate-future-frost-risks.html"><a href="a-robust-method-to-estimate-future-frost-risks.html#validation-1"><i class="fa fa-check"></i><b>34.2</b> Validation</a></li>
<li class="chapter" data-level="34.3" data-path="a-robust-method-to-estimate-future-frost-risks.html"><a href="a-robust-method-to-estimate-future-frost-risks.html#exercises-for-this-chapter"><i class="fa fa-check"></i><b>34.3</b> <code>Exercises</code> for this chapter</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="major_concepts.html"><a href="major_concepts.html"><i class="fa fa-check"></i><b>35</b> Major concepts</a>
<ul>
<li class="chapter" data-level="" data-path="major_concepts.html"><a href="major_concepts.html#goals_major_concepts"><i class="fa fa-check"></i>Learning goals for this lesson</a></li>
<li class="chapter" data-level="35.1" data-path="major_concepts.html"><a href="major_concepts.html#key-insights"><i class="fa fa-check"></i><b>35.1</b> Key insights</a>
<ul>
<li class="chapter" data-level="35.1.1" data-path="major_concepts.html"><a href="major_concepts.html#tree-dormancy-1"><i class="fa fa-check"></i><b>35.1.1</b> Tree dormancy</a></li>
<li class="chapter" data-level="35.1.2" data-path="major_concepts.html"><a href="major_concepts.html#climate-change"><i class="fa fa-check"></i><b>35.1.2</b> Climate change</a></li>
<li class="chapter" data-level="35.1.3" data-path="major_concepts.html"><a href="major_concepts.html#phenology-modeling"><i class="fa fa-check"></i><b>35.1.3</b> Phenology modeling</a></li>
<li class="chapter" data-level="35.1.4" data-path="major_concepts.html"><a href="major_concepts.html#phenology-responses-to-global-warming"><i class="fa fa-check"></i><b>35.1.4</b> Phenology responses to global warming</a></li>
<li class="chapter" data-level="35.1.5" data-path="major_concepts.html"><a href="major_concepts.html#the-phenoflex-modeling-framework"><i class="fa fa-check"></i><b>35.1.5</b> The <code>PhenoFlex</code> modeling framework</a></li>
</ul></li>
<li class="chapter" data-level="35.2" data-path="major_concepts.html"><a href="major_concepts.html#major-concepts-weve-encountered"><i class="fa fa-check"></i><b>35.2</b> Major concepts we’ve encountered</a>
<ul>
<li class="chapter" data-level="35.2.1" data-path="major_concepts.html"><a href="major_concepts.html#reproducibility-and-transparency"><i class="fa fa-check"></i><b>35.2.1</b> Reproducibility and transparency</a></li>
<li class="chapter" data-level="35.2.2" data-path="major_concepts.html"><a href="major_concepts.html#tools"><i class="fa fa-check"></i><b>35.2.2</b> Tools</a></li>
<li class="chapter" data-level="35.2.3" data-path="major_concepts.html"><a href="major_concepts.html#automate-and-move-on"><i class="fa fa-check"></i><b>35.2.3</b> Automate and move on</a></li>
<li class="chapter" data-level="35.2.4" data-path="major_concepts.html"><a href="major_concepts.html#the-power-of-r"><i class="fa fa-check"></i><b>35.2.4</b> The power of R</a></li>
<li class="chapter" data-level="35.2.5" data-path="major_concepts.html"><a href="major_concepts.html#curiosity-and-interdisciplinarity"><i class="fa fa-check"></i><b>35.2.5</b> Curiosity and interdisciplinarity</a></li>
<li class="chapter" data-level="35.2.6" data-path="major_concepts.html"><a href="major_concepts.html#uncertainty"><i class="fa fa-check"></i><b>35.2.6</b> Uncertainty</a></li>
<li class="chapter" data-level="35.2.7" data-path="major_concepts.html"><a href="major_concepts.html#p-hacking-1"><i class="fa fa-check"></i><b>35.2.7</b> p-hacking</a></li>
<li class="chapter" data-level="35.2.8" data-path="major_concepts.html"><a href="major_concepts.html#the-dangers-of-machine-learning"><i class="fa fa-check"></i><b>35.2.8</b> The dangers of machine learning</a></li>
<li class="chapter" data-level="35.2.9" data-path="major_concepts.html"><a href="major_concepts.html#rationalizing"><i class="fa fa-check"></i><b>35.2.9</b> Rationalizing</a></li>
<li class="chapter" data-level="35.2.10" data-path="major_concepts.html"><a href="major_concepts.html#overfitting"><i class="fa fa-check"></i><b>35.2.10</b> Overfitting</a></li>
<li class="chapter" data-level="35.2.11" data-path="major_concepts.html"><a href="major_concepts.html#the-process-that-generated-the-data"><i class="fa fa-check"></i><b>35.2.11</b> The process that generated the data</a></li>
<li class="chapter" data-level="35.2.12" data-path="major_concepts.html"><a href="major_concepts.html#the-importance-of-theory"><i class="fa fa-check"></i><b>35.2.12</b> The importance of theory</a></li>
<li class="chapter" data-level="35.2.13" data-path="major_concepts.html"><a href="major_concepts.html#conceptual-modeling"><i class="fa fa-check"></i><b>35.2.13</b> Conceptual modeling</a></li>
<li class="chapter" data-level="35.2.14" data-path="major_concepts.html"><a href="major_concepts.html#consistency-with-existing-theory-and-prior-knowledge"><i class="fa fa-check"></i><b>35.2.14</b> Consistency with existing theory and prior knowledge</a></li>
<li class="chapter" data-level="35.2.15" data-path="major_concepts.html"><a href="major_concepts.html#model-validity-and-model-validation"><i class="fa fa-check"></i><b>35.2.15</b> Model validity and model validation</a></li>
<li class="chapter" data-level="35.2.16" data-path="major_concepts.html"><a href="major_concepts.html#our-role-in-research"><i class="fa fa-check"></i><b>35.2.16</b> Our role in research</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="major_concepts.html"><a href="major_concepts.html#ex_majorconcepts"><i class="fa fa-check"></i><code>Exercises</code> on major concepts</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="refs.html"><a href="refs.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tree phenology analysis with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="filling-gaps-in-temperature-records" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Filling gaps in temperature records<a href="filling-gaps-in-temperature-records.html#filling-gaps-in-temperature-records" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="goals_gaps" class="section level2 unnumbered hasAnchor">
<h2>Learning goals for this lesson<a href="filling-gaps-in-temperature-records.html#goals_gaps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>see why having gaps in records can be quite problematic</li>
<li>learn about (too?) simple ways to fill gaps in daily temperature records</li>
<li>learn how to use data from auxiliary weather stations to fill gaps in daily temperature records</li>
<li>learn about a creative way to close gaps in hourly temperature records</li>
</ul>
</div>
<div id="gaps" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Gaps<a href="filling-gaps-in-temperature-records.html#gaps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There’s a lot of weather data out there, but most of it isn’t perfect. Lots of things can go wrong when recording temperature data, including malfunctioning equipment, flat batteries, power cuts or lack of maintenance. Data archiving, transmission and storage in a database presents the next hurdle. Many datasets therefore have gaps that can be very annoying when you’re trying to model agroclimatic conditions. Many scientific methods don’t deal very well with missing data. So we need ways of filling such gaps.</p>
</div>
<div id="filling-short-gaps-in-daily-records" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Filling short gaps in daily records<a href="filling-gaps-in-temperature-records.html#filling-short-gaps-in-daily-records" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Weather records may be largely complete, except for isolated incidences of missing daily minimum or maximum temperatures. In such cases, we may get away with simple linear interpolation. This means, we take the last recorded value before a gaps and the first after the gap and compute the average. We can use equivalent procedures for slightly longer gaps (e.g. 2-3 days), and possibly even a few more (even though we should now be starting to feel a bit uneasy about this). Obviously, the longer the gaps, the more dubious this practice becomes. In case gaps extend to several weeks or even months, linear interpolation, which simply connects the start and end points of the gap by a straight line, may miss important features of the local temperature dynamics. In the extreme case, where we’re missing an entire year of data, such linear interpolation would miss entire seasons, producing unacceptable errors. Yet <code>chillR</code> has a function to implement such simple interpolation - <code>interpolate_gaps()</code>.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="filling-gaps-in-temperature-records.html#cb124-1" tabindex="-1"></a><span class="fu">library</span>(chillR)</span>
<span id="cb124-2"><a href="filling-gaps-in-temperature-records.html#cb124-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb124-3"><a href="filling-gaps-in-temperature-records.html#cb124-3" tabindex="-1"></a>weather <span class="ot">&lt;-</span> KA_weather <span class="sc">%&gt;%</span> <span class="fu">make_all_day_table</span>()</span>
<span id="cb124-4"><a href="filling-gaps-in-temperature-records.html#cb124-4" tabindex="-1"></a></span>
<span id="cb124-5"><a href="filling-gaps-in-temperature-records.html#cb124-5" tabindex="-1"></a>Tmin_int <span class="ot">&lt;-</span> <span class="fu">interpolate_gaps</span>(weather[,<span class="st">&quot;Tmin&quot;</span>])</span>
<span id="cb124-6"><a href="filling-gaps-in-temperature-records.html#cb124-6" tabindex="-1"></a></span>
<span id="cb124-7"><a href="filling-gaps-in-temperature-records.html#cb124-7" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Tmin =</span> Tmin_int<span class="sc">$</span>interp,</span>
<span id="cb124-8"><a href="filling-gaps-in-temperature-records.html#cb124-8" tabindex="-1"></a>                              <span class="at">Tmin_interpolated =</span> Tmin_int<span class="sc">$</span>missing)</span>
<span id="cb124-9"><a href="filling-gaps-in-temperature-records.html#cb124-9" tabindex="-1"></a></span>
<span id="cb124-10"><a href="filling-gaps-in-temperature-records.html#cb124-10" tabindex="-1"></a>Tmax_int <span class="ot">&lt;-</span> <span class="fu">interpolate_gaps</span>(weather[,<span class="st">&quot;Tmax&quot;</span>])</span>
<span id="cb124-11"><a href="filling-gaps-in-temperature-records.html#cb124-11" tabindex="-1"></a></span>
<span id="cb124-12"><a href="filling-gaps-in-temperature-records.html#cb124-12" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Tmax =</span> Tmax_int<span class="sc">$</span>interp,</span>
<span id="cb124-13"><a href="filling-gaps-in-temperature-records.html#cb124-13" tabindex="-1"></a>                              <span class="at">Tmax_interpolated =</span> Tmax_int<span class="sc">$</span>missing)</span></code></pre></div>
<p>The <code>fix_weather()</code> function in <code>chillR</code> uses the same procedure. If you run this without any additional arguments (just <code>fix_weather(weather)</code>), this function assumes you’re trying to linearly interpolate all gaps in the <code>Tmin</code> and <code>Tmax</code> columns. If entire days are missing in the records, new lines are added for these days (using the <code>make_all_day_table()</code> function). You can also specify the range of years to apply this procedure for (by specifying <code>start_year</code> and <code>end_year</code>), the dates to work on (<code>start_date</code> and <code>end_date</code> - these are in Julian days, i.e. days of the year) and the names of columns you want to work on (needed if these are different from <code>Tmin</code> and <code>Tmax</code>)</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="filling-gaps-in-temperature-records.html#cb125-1" tabindex="-1"></a><span class="co"># add an extra day to the KA_weather dataset that is not connected to the days that are already there.</span></span>
<span id="cb125-2"><a href="filling-gaps-in-temperature-records.html#cb125-2" tabindex="-1"></a><span class="co"># this creates a large gap, which we can then interpolate</span></span>
<span id="cb125-3"><a href="filling-gaps-in-temperature-records.html#cb125-3" tabindex="-1"></a>KA_weather_gap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(KA_weather, <span class="fu">c</span>(<span class="at">Year =</span> <span class="dv">2011</span>,</span>
<span id="cb125-4"><a href="filling-gaps-in-temperature-records.html#cb125-4" tabindex="-1"></a>                                      <span class="at">Month =</span> <span class="dv">3</span>,</span>
<span id="cb125-5"><a href="filling-gaps-in-temperature-records.html#cb125-5" tabindex="-1"></a>                                      <span class="at">Day =</span> <span class="dv">3</span>,</span>
<span id="cb125-6"><a href="filling-gaps-in-temperature-records.html#cb125-6" tabindex="-1"></a>                                      <span class="at">Tmax =</span> <span class="dv">26</span>,</span>
<span id="cb125-7"><a href="filling-gaps-in-temperature-records.html#cb125-7" tabindex="-1"></a>                                      <span class="at">Tmin =</span> <span class="dv">14</span>)) </span>
<span id="cb125-8"><a href="filling-gaps-in-temperature-records.html#cb125-8" tabindex="-1"></a></span>
<span id="cb125-9"><a href="filling-gaps-in-temperature-records.html#cb125-9" tabindex="-1"></a><span class="co"># fill in the gaps between Julian date 300 (late October) and 100 (early April), only returning data between 2000 and 2011</span></span>
<span id="cb125-10"><a href="filling-gaps-in-temperature-records.html#cb125-10" tabindex="-1"></a>fixed_winter_days <span class="ot">&lt;-</span> KA_weather_gap <span class="sc">%&gt;%</span> <span class="fu">fix_weather</span>(<span class="at">start_year =</span> <span class="dv">2000</span>,</span>
<span id="cb125-11"><a href="filling-gaps-in-temperature-records.html#cb125-11" tabindex="-1"></a>                                                    <span class="at">end_year =</span> <span class="dv">2011</span>,</span>
<span id="cb125-12"><a href="filling-gaps-in-temperature-records.html#cb125-12" tabindex="-1"></a>                                                    <span class="at">start_date =</span> <span class="dv">300</span>,</span>
<span id="cb125-13"><a href="filling-gaps-in-temperature-records.html#cb125-13" tabindex="-1"></a>                                                    <span class="at">end_date =</span> <span class="dv">100</span>)</span>
<span id="cb125-14"><a href="filling-gaps-in-temperature-records.html#cb125-14" tabindex="-1"></a></span>
<span id="cb125-15"><a href="filling-gaps-in-temperature-records.html#cb125-15" tabindex="-1"></a><span class="co"># fill in all gaps</span></span>
<span id="cb125-16"><a href="filling-gaps-in-temperature-records.html#cb125-16" tabindex="-1"></a>fixed_all_days <span class="ot">&lt;-</span> KA_weather_gap <span class="sc">%&gt;%</span> <span class="fu">fix_weather</span>()</span></code></pre></div>
<p>The <code>fix_weather()</code> function produces a list with two outputs:</p>
<ul>
<li><p><code>weather</code>: a <code>data.frame</code> with the interpolated weather data, now including columns <code>no_Tmin</code> and <code>no_Tmax</code>, which contain <code>TRUE</code> for rows where the respective values were originally missing (<code>FALSE</code> otherwise).</p></li>
<li><p><code>QC</code>: a quality control object that summarizes how many values were interpolated for each season.</p></li>
</ul>
<p>Here’s how the QC elements look for the two interpolated datasets we just created:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="filling-gaps-in-temperature-records.html#cb126-1" tabindex="-1"></a>fixed_winter_days<span class="sc">$</span>QC</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-33">Table 11.1: </span><span id="tab:unnamed-chunk-33">Table 11.2: </span>Quality control summary produced by <em>fix_weather()</em>, with only winter days interpolated
</caption>
<thead>
<tr>
<th style="text-align:left;">
Season
</th>
<th style="text-align:right;">
End_year
</th>
<th style="text-align:right;">
Season_days
</th>
<th style="text-align:right;">
Data_days
</th>
<th style="text-align:right;">
Missing_Tmin
</th>
<th style="text-align:right;">
Missing_Tmax
</th>
<th style="text-align:right;">
Incomplete_days
</th>
<th style="text-align:right;">
Perc_complete
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1999/2000
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
60.2
</td>
</tr>
<tr>
<td style="text-align:left;">
2000/2001
</td>
<td style="text-align:right;">
2001
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2001/2002
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2002/2003
</td>
<td style="text-align:right;">
2003
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2003/2004
</td>
<td style="text-align:right;">
2004
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2004/2005
</td>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2005/2006
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2006/2007
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2007/2008
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2008/2009
</td>
<td style="text-align:right;">
2009
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
167
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009/2010
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2010/2011
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
128
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
0.6
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="filling-gaps-in-temperature-records.html#cb127-1" tabindex="-1"></a>fixed_all_days<span class="sc">$</span>QC</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-35">Table 11.3: </span><span id="tab:unnamed-chunk-35">Table 11.4: </span>Quality control summary produced by <em>fix_weather()</em>, with all days interpolated
</caption>
<thead>
<tr>
<th style="text-align:left;">
Season
</th>
<th style="text-align:right;">
End_year
</th>
<th style="text-align:right;">
Season_days
</th>
<th style="text-align:right;">
Data_days
</th>
<th style="text-align:right;">
Missing_Tmin
</th>
<th style="text-align:right;">
Missing_Tmax
</th>
<th style="text-align:right;">
Incomplete_days
</th>
<th style="text-align:right;">
Perc_complete
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1997/1998
</td>
<td style="text-align:right;">
1998
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1998/1999
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1999/2000
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2000/2001
</td>
<td style="text-align:right;">
2001
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2001/2002
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2002/2003
</td>
<td style="text-align:right;">
2003
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2003/2004
</td>
<td style="text-align:right;">
2004
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2004/2005
</td>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2005/2006
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2006/2007
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2007/2008
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2008/2009
</td>
<td style="text-align:right;">
2009
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009/2010
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
214
</td>
<td style="text-align:right;">
214
</td>
<td style="text-align:right;">
214
</td>
<td style="text-align:right;">
41.4
</td>
</tr>
<tr>
<td style="text-align:left;">
2010/2011
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
364
</td>
<td style="text-align:right;">
364
</td>
<td style="text-align:right;">
364
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
</tbody>
</table>
<p>As indicated above, linear interpolation is usually acceptable for short gaps in the records, but it gets increasingly less convincing, when the gaps are longer. Here’s a quick demonstration of this:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="filling-gaps-in-temperature-records.html#cb128-1" tabindex="-1"></a>gap_weather <span class="ot">&lt;-</span> KA_weather[<span class="dv">200</span><span class="sc">:</span><span class="dv">305</span>,]</span>
<span id="cb128-2"><a href="filling-gaps-in-temperature-records.html#cb128-2" tabindex="-1"></a>gap_weather[,<span class="st">&quot;Tmin_observed&quot;</span>] <span class="ot">&lt;-</span> gap_weather<span class="sc">$</span>Tmin</span>
<span id="cb128-3"><a href="filling-gaps-in-temperature-records.html#cb128-3" tabindex="-1"></a>gap_weather<span class="sc">$</span>Tmin[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>,<span class="dv">11</span><span class="sc">:</span><span class="dv">14</span>,<span class="dv">16</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">22</span><span class="sc">:</span><span class="dv">27</span>,<span class="dv">29</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb128-4"><a href="filling-gaps-in-temperature-records.html#cb128-4" tabindex="-1"></a>                   <span class="dv">37</span><span class="sc">:</span><span class="dv">44</span>,<span class="dv">46</span><span class="sc">:</span><span class="dv">54</span>,<span class="dv">56</span><span class="sc">:</span><span class="dv">65</span>,<span class="dv">67</span><span class="sc">:</span><span class="dv">77</span>,<span class="dv">79</span><span class="sc">:</span><span class="dv">90</span>,<span class="dv">92</span><span class="sc">:</span><span class="dv">104</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb128-5"><a href="filling-gaps-in-temperature-records.html#cb128-5" tabindex="-1"></a>fixed_gaps <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(gap_weather)<span class="sc">$</span>weather</span>
<span id="cb128-6"><a href="filling-gaps-in-temperature-records.html#cb128-6" tabindex="-1"></a></span>
<span id="cb128-7"><a href="filling-gaps-in-temperature-records.html#cb128-7" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>fixed_gaps,</span>
<span id="cb128-8"><a href="filling-gaps-in-temperature-records.html#cb128-8" tabindex="-1"></a>       <span class="fu">aes</span>(DATE,Tmin_observed)) <span class="sc">+</span></span>
<span id="cb128-9"><a href="filling-gaps-in-temperature-records.html#cb128-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd=</span><span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb128-10"><a href="filling-gaps-in-temperature-records.html#cb128-10" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-11"><a href="filling-gaps-in-temperature-records.html#cb128-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Daily minimum temperature (°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-12"><a href="filling-gaps-in-temperature-records.html#cb128-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>fixed_gaps,<span class="fu">aes</span>(DATE,Tmin),<span class="at">col=</span><span class="st">&quot;red&quot;</span>,<span class="at">lwd=</span><span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="Book_files/figure-html/widening_gaps-1.png" width="672" /></p>
<p>The plot above shows the originally measured values in black and the interpolated values in red. To create gaps in the record for interpolation, I removed values from the original dataset, starting with gaps of length==1 on the left, and ending up with 13 missing values on the right. As you see, temperature dynamics are captured quite well on the left, but no longer very well on the right. Here’s how far off we are:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="filling-gaps-in-temperature-records.html#cb129-1" tabindex="-1"></a>fixed_gaps[,<span class="st">&quot;error&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">abs</span>(fixed_gaps<span class="sc">$</span>Tmin <span class="sc">-</span> fixed_gaps<span class="sc">$</span>Tmin_observed)</span>
<span id="cb129-2"><a href="filling-gaps-in-temperature-records.html#cb129-2" tabindex="-1"></a></span>
<span id="cb129-3"><a href="filling-gaps-in-temperature-records.html#cb129-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>fixed_gaps,</span>
<span id="cb129-4"><a href="filling-gaps-in-temperature-records.html#cb129-4" tabindex="-1"></a>       <span class="fu">aes</span>(DATE,error)) <span class="sc">+</span></span>
<span id="cb129-5"><a href="filling-gaps-in-temperature-records.html#cb129-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd=</span><span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb129-6"><a href="filling-gaps-in-temperature-records.html#cb129-6" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-7"><a href="filling-gaps-in-temperature-records.html#cb129-7" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Error introduced by interpolation (°C)&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-8"><a href="filling-gaps-in-temperature-records.html#cb129-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>fixed_gaps[<span class="fu">which</span>(<span class="sc">!</span>fixed_gaps<span class="sc">$</span>no_Tmin),],</span>
<span id="cb129-9"><a href="filling-gaps-in-temperature-records.html#cb129-9" tabindex="-1"></a>             <span class="fu">aes</span>(DATE,error),<span class="at">col=</span><span class="st">&quot;red&quot;</span>,<span class="at">cex=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="Book_files/figure-html/gaps_error-1.png" width="672" /></p>
<p>How big the errors get obviously depends on the nature of the dataset - was there a lot of variation during the period of interest, or not? Yet we see a tendency here of errors getting bigger and bigger with increasing gap sizes. Of course for the non-gap points (shown in red in the plot), the error is zero, but especially in the middle of the larger gaps, we can be quite far off from what actually happened.</p>
<p>For large gaps, we need a better procedure!</p>
</div>
<div id="filling-long-gaps-in-daily-records" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Filling long gaps in daily records<a href="filling-gaps-in-temperature-records.html#filling-long-gaps-in-daily-records" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Long gaps in temperature records are a problem - and we can’t make this go away entirely. To stress the obvious again: We can’t know exactly what the temperatures were in a given location at a particular time, if nobody measured them. But we can make pretty good guesses. For short gaps, linear interpolation may be enough. We could now also experiment with more complex interpolation algorithms, but this is not the direction I want to take here. Instead, let’s try to look for additional data that can help us deal with this challenge.</p>
<p>We’ve already learned about one good source of temperature data, and of course there are lots of other records out there. Chances are that, unless we’re working way back in the past, or on a remote island, we can find another weather station that is close enough to be in a climatically comparable setting. Some researchers have identified such stations and then simply used the data from there to fill gaps for the site of interest. This (as far as I understand it) is the preferred way of dealing with gaps in records in the <a href="https://cimis.water.ca.gov/">CIMIS</a> network in California (at least this used to be the default option on their website).</p>
<p>This may work ok, if the auxiliary station is in a <em>very</em> similar climatic setting, but it will already introduce an error if we’re dealing with some elevation differences, or with other landscape features that have climatic effects (e.g. lakes, sea, forest). Such features, as well as topography, can modulate temperatures at a particular place in a way that makes them poor proxies of temperatures in another location.</p>
<p><code>chillR</code> contains a function, <code>patch_weather()</code>, that can fill gaps in a weather record based on a list of weather datasets from auxiliary stations. This function can test for (some) biases, correct data for bias in mean temperatures, and use the result to fill gaps in the record for the location of interest.</p>
<p>Let’s try to fill gaps in the dataset for Bonn that we downloaded in the <a href="get_temp_data.html#get_temp_data">Getting temperature data</a> lesson.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="filling-gaps-in-temperature-records.html#cb130-1" tabindex="-1"></a>Bonn <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/Bonn_chillR_weather.csv&quot;</span>)</span>
<span id="cb130-2"><a href="filling-gaps-in-temperature-records.html#cb130-2" tabindex="-1"></a></span>
<span id="cb130-3"><a href="filling-gaps-in-temperature-records.html#cb130-3" tabindex="-1"></a>Bonn_QC <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(Bonn)<span class="sc">$</span>QC</span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="filling-gaps-in-temperature-records.html#cb131-1" tabindex="-1"></a>Bonn_QC</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-38">Table 11.5: </span><span id="tab:unnamed-chunk-38">Table 11.6: </span>Quality control summary produced by <em>fix_weather()</em>
</caption>
<thead>
<tr>
<th style="text-align:left;">
Season
</th>
<th style="text-align:right;">
End_year
</th>
<th style="text-align:right;">
Season_days
</th>
<th style="text-align:right;">
Data_days
</th>
<th style="text-align:right;">
Missing_Tmin
</th>
<th style="text-align:right;">
Missing_Tmax
</th>
<th style="text-align:right;">
Incomplete_days
</th>
<th style="text-align:right;">
Perc_complete
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1989/1990
</td>
<td style="text-align:right;">
1990
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1990/1991
</td>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1991/1992
</td>
<td style="text-align:right;">
1992
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1992/1993
</td>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1993/1994
</td>
<td style="text-align:right;">
1994
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1994/1995
</td>
<td style="text-align:right;">
1995
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1995/1996
</td>
<td style="text-align:right;">
1996
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1996/1997
</td>
<td style="text-align:right;">
1997
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1997/1998
</td>
<td style="text-align:right;">
1998
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
98.9
</td>
</tr>
<tr>
<td style="text-align:left;">
1998/1999
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1999/2000
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2000/2001
</td>
<td style="text-align:right;">
2001
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2001/2002
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2002/2003
</td>
<td style="text-align:right;">
2003
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
316
</td>
<td style="text-align:right;">
316
</td>
<td style="text-align:right;">
316
</td>
<td style="text-align:right;">
13.4
</td>
</tr>
<tr>
<td style="text-align:left;">
2003/2004
</td>
<td style="text-align:right;">
2004
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2004/2005
</td>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2005/2006
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2006/2007
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2007/2008
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2008/2009
</td>
<td style="text-align:right;">
2009
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009/2010
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2010/2011
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2011/2012
</td>
<td style="text-align:right;">
2012
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2012/2013
</td>
<td style="text-align:right;">
2013
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2013/2014
</td>
<td style="text-align:right;">
2014
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2014/2015
</td>
<td style="text-align:right;">
2015
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2015/2016
</td>
<td style="text-align:right;">
2016
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2016/2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2017/2018
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2018/2019
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2019/2020
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
</tbody>
</table>
<p>As you see, this dataset has substantial gaps between 1998 and 2004 and in 2008 (almost all values missing), and some shorter gaps in 2015, 2018 and 2020.</p>
<p>We’ll now need data from other weather stations in the neighborhood. To find them, we can again use the <code>handle_gsod()</code> function:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="filling-gaps-in-temperature-records.html#cb132-1" tabindex="-1"></a>station_list <span class="ot">&lt;-</span> <span class="fu">handle_gsod</span>(<span class="at">action=</span><span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb132-2"><a href="filling-gaps-in-temperature-records.html#cb132-2" tabindex="-1"></a>                            <span class="at">location=</span><span class="fu">c</span>(<span class="fl">7.10</span>,<span class="fl">50.73</span>),</span>
<span id="cb132-3"><a href="filling-gaps-in-temperature-records.html#cb132-3" tabindex="-1"></a>                            <span class="at">time_interval=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>))</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="filling-gaps-in-temperature-records.html#cb133-1" tabindex="-1"></a>station_list</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-40">Table 11.7: </span><span id="tab:unnamed-chunk-40">Table 11.8: </span>List of GSOD weather stations close to Bonn
</caption>
<thead>
<tr>
<th style="text-align:right;">
chillR_code
</th>
<th style="text-align:left;">
STATION.NAME
</th>
<th style="text-align:left;">
CTRY
</th>
<th style="text-align:right;">
Lat
</th>
<th style="text-align:right;">
Long
</th>
<th style="text-align:right;">
BEGIN
</th>
<th style="text-align:right;">
END
</th>
<th style="text-align:right;">
Distance
</th>
<th style="text-align:right;">
Overlap_years
</th>
<th style="text-align:right;">
Perc_interval_covered
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10517099999
</td>
<td style="text-align:left;">
BONN/FRIESDORF(AUT)
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.700
</td>
<td style="text-align:right;">
7.150
</td>
<td style="text-align:right;">
19360102
</td>
<td style="text-align:right;">
19921231
</td>
<td style="text-align:right;">
4.86
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
10518099999
</td>
<td style="text-align:left;">
BONN-HARDTHOEHE
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.700
</td>
<td style="text-align:right;">
7.033
</td>
<td style="text-align:right;">
19750523
</td>
<td style="text-align:right;">
19971223
</td>
<td style="text-align:right;">
5.79
</td>
<td style="text-align:right;">
7.98
</td>
<td style="text-align:right;">
26
</td>
</tr>
<tr>
<td style="text-align:right;">
10519099999
</td>
<td style="text-align:left;">
BONN-ROLEBER
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.733
</td>
<td style="text-align:right;">
7.200
</td>
<td style="text-align:right;">
20010705
</td>
<td style="text-align:right;">
20081231
</td>
<td style="text-align:right;">
7.07
</td>
<td style="text-align:right;">
7.49
</td>
<td style="text-align:right;">
24
</td>
</tr>
<tr>
<td style="text-align:right;">
10513099999
</td>
<td style="text-align:left;">
KOLN BONN
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.866
</td>
<td style="text-align:right;">
7.143
</td>
<td style="text-align:right;">
19310101
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
15.43
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
10509099999
</td>
<td style="text-align:left;">
BUTZWEILERHOF(BAFB)
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.983
</td>
<td style="text-align:right;">
6.900
</td>
<td style="text-align:right;">
19780901
</td>
<td style="text-align:right;">
19950823
</td>
<td style="text-align:right;">
31.47
</td>
<td style="text-align:right;">
5.64
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:right;">
10502099999
</td>
<td style="text-align:left;">
NORVENICH
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.831
</td>
<td style="text-align:right;">
6.658
</td>
<td style="text-align:right;">
19730101
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
33.14
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
10514099999
</td>
<td style="text-align:left;">
MENDIG
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.366
</td>
<td style="text-align:right;">
7.315
</td>
<td style="text-align:right;">
19730102
</td>
<td style="text-align:right;">
19971231
</td>
<td style="text-align:right;">
43.26
</td>
<td style="text-align:right;">
8.00
</td>
<td style="text-align:right;">
26
</td>
</tr>
<tr>
<td style="text-align:right;">
10506099999
</td>
<td style="text-align:left;">
NUERBURG-BARWEILER
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.367
</td>
<td style="text-align:right;">
6.867
</td>
<td style="text-align:right;">
19950401
</td>
<td style="text-align:right;">
19971231
</td>
<td style="text-align:right;">
43.63
</td>
<td style="text-align:right;">
2.75
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
10508099999
</td>
<td style="text-align:left;">
BLANKENHEIM
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.450
</td>
<td style="text-align:right;">
6.650
</td>
<td style="text-align:right;">
19781002
</td>
<td style="text-align:right;">
19840504
</td>
<td style="text-align:right;">
44.56
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
10510099999
</td>
<td style="text-align:left;">
NUERBURG
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.333
</td>
<td style="text-align:right;">
6.950
</td>
<td style="text-align:right;">
19300901
</td>
<td style="text-align:right;">
19921231
</td>
<td style="text-align:right;">
45.42
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:right;">
10515099999
</td>
<td style="text-align:left;">
BENDORF
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.417
</td>
<td style="text-align:right;">
7.583
</td>
<td style="text-align:right;">
19310102
</td>
<td style="text-align:right;">
20030816
</td>
<td style="text-align:right;">
48.82
</td>
<td style="text-align:right;">
13.62
</td>
<td style="text-align:right;">
44
</td>
</tr>
<tr>
<td style="text-align:right;">
10504099999
</td>
<td style="text-align:left;">
EIFEL
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.650
</td>
<td style="text-align:right;">
6.283
</td>
<td style="text-align:right;">
20040501
</td>
<td style="text-align:right;">
20040501
</td>
<td style="text-align:right;">
58.41
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
10526099999
</td>
<td style="text-align:left;">
BAD MARIENBERG
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.667
</td>
<td style="text-align:right;">
7.967
</td>
<td style="text-align:right;">
19730101
</td>
<td style="text-align:right;">
20030816
</td>
<td style="text-align:right;">
61.65
</td>
<td style="text-align:right;">
13.62
</td>
<td style="text-align:right;">
44
</td>
</tr>
<tr>
<td style="text-align:right;">
10613099999
</td>
<td style="text-align:left;">
BUCHEL
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.174
</td>
<td style="text-align:right;">
7.063
</td>
<td style="text-align:right;">
19730101
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
61.90
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
10503099999
</td>
<td style="text-align:left;">
AACHEN/MERZBRUCK
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.817
</td>
<td style="text-align:right;">
6.183
</td>
<td style="text-align:right;">
19780901
</td>
<td style="text-align:right;">
19971212
</td>
<td style="text-align:right;">
65.40
</td>
<td style="text-align:right;">
7.95
</td>
<td style="text-align:right;">
26
</td>
</tr>
<tr>
<td style="text-align:right;">
10419099999
</td>
<td style="text-align:left;">
LUDENSCHEID &amp;
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.233
</td>
<td style="text-align:right;">
7.600
</td>
<td style="text-align:right;">
19270906
</td>
<td style="text-align:right;">
20030306
</td>
<td style="text-align:right;">
66.06
</td>
<td style="text-align:right;">
13.18
</td>
<td style="text-align:right;">
43
</td>
</tr>
<tr>
<td style="text-align:right;">
10400099999
</td>
<td style="text-align:left;">
DUSSELDORF
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.289
</td>
<td style="text-align:right;">
6.767
</td>
<td style="text-align:right;">
19310102
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
66.43
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
10616299999
</td>
<td style="text-align:left;">
SIEGERLAND
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.708
</td>
<td style="text-align:right;">
8.083
</td>
<td style="text-align:right;">
20040510
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
69.46
</td>
<td style="text-align:right;">
16.65
</td>
<td style="text-align:right;">
54
</td>
</tr>
<tr>
<td style="text-align:right;">
10418099999
</td>
<td style="text-align:left;">
LUEDENSCHEID
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.250
</td>
<td style="text-align:right;">
7.650
</td>
<td style="text-align:right;">
19940301
</td>
<td style="text-align:right;">
19971231
</td>
<td style="text-align:right;">
69.55
</td>
<td style="text-align:right;">
3.84
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:right;">
10437499999
</td>
<td style="text-align:left;">
MONCHENGLADBACH
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.230
</td>
<td style="text-align:right;">
6.504
</td>
<td style="text-align:right;">
19960715
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
69.61
</td>
<td style="text-align:right;">
24.47
</td>
<td style="text-align:right;">
79
</td>
</tr>
<tr>
<td style="text-align:right;">
10403099999
</td>
<td style="text-align:left;">
MOENCHENGLADBACH
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.233
</td>
<td style="text-align:right;">
6.500
</td>
<td style="text-align:right;">
19381001
</td>
<td style="text-align:right;">
19421031
</td>
<td style="text-align:right;">
70.05
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
10501099999
</td>
<td style="text-align:left;">
AACHEN
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
50.783
</td>
<td style="text-align:right;">
6.100
</td>
<td style="text-align:right;">
19280101
</td>
<td style="text-align:right;">
20030816
</td>
<td style="text-align:right;">
70.81
</td>
<td style="text-align:right;">
13.62
</td>
<td style="text-align:right;">
44
</td>
</tr>
<tr>
<td style="text-align:right;">
6496099999
</td>
<td style="text-align:left;">
ELSENBORN (MIL)
</td>
<td style="text-align:left;">
BE
</td>
<td style="text-align:right;">
50.467
</td>
<td style="text-align:right;">
6.183
</td>
<td style="text-align:right;">
19840501
</td>
<td style="text-align:right;">
20230729
</td>
<td style="text-align:right;">
71.21
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
10409099999
</td>
<td style="text-align:left;">
ESSEN/MUELHEIM
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.400
</td>
<td style="text-align:right;">
6.967
</td>
<td style="text-align:right;">
19300414
</td>
<td style="text-align:right;">
19431231
</td>
<td style="text-align:right;">
75.12
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
10410099999
</td>
<td style="text-align:left;">
ESSEN/MULHEIM
</td>
<td style="text-align:left;">
GM
</td>
<td style="text-align:right;">
51.400
</td>
<td style="text-align:right;">
6.967
</td>
<td style="text-align:right;">
19310101
</td>
<td style="text-align:right;">
20220408
</td>
<td style="text-align:right;">
75.12
</td>
<td style="text-align:right;">
31.00
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>
</table>
<p>We can see that many of the listed stations aren’t very useful for us, because they only overlap with the record we already have for a few years, in some cases not at all. So it’s quite possible that none of these stations can help us fill all the gaps in the temperature data for Bonn. But maybe we can combine data from multiple auxiliary stations to close all the gaps. Stations that look promising are BONN-HARDTHOEHE, BONN-ROLEBER, and NORVENICH. So let’s download these and store them in a list.</p>
<p>As of <code>chillR</code> version 0.74, the <code>handle_gsod</code> function can download multiple files at ones, returning a named list of station records. Let’s use this function to download the records for the stations of interest (positions 2, 3 and 6 in the <code>station_list</code>).</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="filling-gaps-in-temperature-records.html#cb134-1" tabindex="-1"></a>patch_weather<span class="ot">&lt;-</span></span>
<span id="cb134-2"><a href="filling-gaps-in-temperature-records.html#cb134-2" tabindex="-1"></a>      <span class="fu">handle_gsod</span>(<span class="at">action =</span> <span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb134-3"><a href="filling-gaps-in-temperature-records.html#cb134-3" tabindex="-1"></a>                  <span class="at">location =</span> <span class="fu">as.character</span>(station_list<span class="sc">$</span>chillR_code[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>)]),</span>
<span id="cb134-4"><a href="filling-gaps-in-temperature-records.html#cb134-4" tabindex="-1"></a>                  <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">2020</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb134-5"><a href="filling-gaps-in-temperature-records.html#cb134-5" tabindex="-1"></a>  <span class="fu">handle_gsod</span>()</span></code></pre></div>
<p>Now we have a list of weather records that are potentially useful for filling gaps in our record for Bonn. We can now use the <code>patch_daily_temperatures()</code> function to implement this.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="filling-gaps-in-temperature-records.html#cb135-1" tabindex="-1"></a>patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(<span class="at">weather =</span> Bonn,</span>
<span id="cb135-2"><a href="filling-gaps-in-temperature-records.html#cb135-2" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather)</span></code></pre></div>
<p>You can take a look at what happened by looking at the <code>statistics</code> element of the <code>patched</code> object (call <code>patched$statistics</code>):</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="filling-gaps-in-temperature-records.html#cb136-1" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">1</span>]]</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-44">Table 11.9: </span><span id="tab:unnamed-chunk-44">Table 11.10: </span>Patch statistics for NORVENICH
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:right;">
-0.307
</td>
<td style="text-align:right;">
1.304
</td>
<td style="text-align:right;">
2146
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:right;">
0.202
</td>
<td style="text-align:right;">
1.154
</td>
<td style="text-align:right;">
2146
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="filling-gaps-in-temperature-records.html#cb137-1" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">2</span>]]</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-46">Table 11.11: </span><span id="tab:unnamed-chunk-46">Table 11.12: </span>Patch statistics for BONN-HARDTHOEHE
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:right;">
-1.871
</td>
<td style="text-align:right;">
2.080
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:right;">
1.466
</td>
<td style="text-align:right;">
1.427
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="filling-gaps-in-temperature-records.html#cb138-1" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">3</span>]]</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-48">Table 11.13: </span><span id="tab:unnamed-chunk-48">Table 11.14: </span>Patch statistics for BONN-ROLEBER
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:right;">
-0.546
</td>
<td style="text-align:right;">
1.186
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:right;">
1.314
</td>
<td style="text-align:right;">
1.089
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Here we see an analysis of how similar the temperature records (separately for <code>Tmin</code> and <code>Tmax</code>) were between each auxiliary station and our station of interest in Bonn, based on days for which both stations had data. Besides the number of days for which information was taken from each auxiliary station (<code>filled</code>) and the number of gaps that remained afterwards (<code>gaps_remain</code>), we see two quality statistics:</p>
<ol style="list-style-type: decimal">
<li>the mean bias (<code>mean_bias</code>), i.e. the mean temperature difference.</li>
<li>the standard deviation of the daily differences (<code>stdev_bias</code>).</li>
</ol>
<p>The <code>mean_bias</code> is easy to address by adding or subtracting the respective value, when we transfer daily temperature values from one station to the other. The <code>patch_daily_temperatures()</code> function does that for us automatically. We may still want to set some limit to how much we can accept here, but in principle, this can be addressed. What is more problematic is the <code>stdev_bias</code> metric. This basically indicates the extent of additional (possibly unsystematic) differences between stations. I don’t know if this can be adjusted (I haven’t figured it out yet), so for now we should treat this as an exclusion criterion (i.e. if <code>stdev_bias</code> is above a certain value, we reject the station). Let’s set some limits for both metrics, which we can pass as arguments to <code>patch_daily_temperatures()</code> (using the <code>max_mean_bias</code> and <code>max_stdev_bias</code> parameters). Let’s cap the <code>mean_bias</code> at 1 °C and the <code>stdev_bias</code> at 2°C, and then look at the statistics again.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="filling-gaps-in-temperature-records.html#cb139-1" tabindex="-1"></a>patched <span class="ot">&lt;-</span> <span class="fu">patch_daily_temperatures</span>(<span class="at">weather =</span> Bonn,</span>
<span id="cb139-2"><a href="filling-gaps-in-temperature-records.html#cb139-2" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb139-3"><a href="filling-gaps-in-temperature-records.html#cb139-3" tabindex="-1"></a>                                    <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb139-4"><a href="filling-gaps-in-temperature-records.html#cb139-4" tabindex="-1"></a>                                    <span class="at">max_stdev_bias =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="filling-gaps-in-temperature-records.html#cb140-1" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">1</span>]]</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-51">Table 11.15: </span><span id="tab:unnamed-chunk-51">Table 11.16: </span>Patch statistics for NORVENICH
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:right;">
-0.307
</td>
<td style="text-align:right;">
1.304
</td>
<td style="text-align:right;">
2146
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:right;">
0.202
</td>
<td style="text-align:right;">
1.154
</td>
<td style="text-align:right;">
2146
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="filling-gaps-in-temperature-records.html#cb141-1" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">2</span>]]</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-53">Table 11.17: </span><span id="tab:unnamed-chunk-53">Table 11.18: </span>Patch statistics for BONN-HARDTHOEHE
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:right;">
-1.871
</td>
<td style="text-align:right;">
2.080
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:right;">
1.466
</td>
<td style="text-align:right;">
1.427
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="filling-gaps-in-temperature-records.html#cb142-1" tabindex="-1"></a>patched<span class="sc">$</span>statistics[[<span class="dv">3</span>]]</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-55">Table 11.19: </span><span id="tab:unnamed-chunk-55">Table 11.20: </span>Patch statistics for BONN-ROLEBER
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:right;">
-0.546
</td>
<td style="text-align:right;">
1.186
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:right;">
1.314
</td>
<td style="text-align:right;">
1.089
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We can see that all records from BONN-HARDTHOEHE, as well as the <code>Tmax</code> records from BONN-ROLEBER were rejected, because they didn’t pass our <code>mean_bias</code> filter. Still, since the data from NORVENICH are pretty good, we were able to fill 2146 gaps for <code>Tmin</code> and 2146 for <code>Tmax</code>. Only 1 and 1 gaps remain for <code>Tmin</code> and <code>Tmax</code>, respectively.</p>
<p>Let’s use the <code>fix_weather()</code> function to take a look at where the remaining gaps are:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="filling-gaps-in-temperature-records.html#cb143-1" tabindex="-1"></a>post_patch_stats <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(patched)<span class="sc">$</span>QC</span>
<span id="cb143-2"><a href="filling-gaps-in-temperature-records.html#cb143-2" tabindex="-1"></a></span>
<span id="cb143-3"><a href="filling-gaps-in-temperature-records.html#cb143-3" tabindex="-1"></a>post_patch_stats</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-57">Table 11.21: </span><span id="tab:unnamed-chunk-57">Table 11.22: </span>Data completeness table for the weather record from Bonn, after applying the patch procedure
</caption>
<thead>
<tr>
<th style="text-align:left;">
Season
</th>
<th style="text-align:right;">
End_year
</th>
<th style="text-align:right;">
Season_days
</th>
<th style="text-align:right;">
Data_days
</th>
<th style="text-align:right;">
Missing_Tmin
</th>
<th style="text-align:right;">
Missing_Tmax
</th>
<th style="text-align:right;">
Incomplete_days
</th>
<th style="text-align:right;">
Perc_complete
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1989/1990
</td>
<td style="text-align:right;">
1990
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1990/1991
</td>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1991/1992
</td>
<td style="text-align:right;">
1992
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1992/1993
</td>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1993/1994
</td>
<td style="text-align:right;">
1994
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1994/1995
</td>
<td style="text-align:right;">
1995
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1995/1996
</td>
<td style="text-align:right;">
1996
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1996/1997
</td>
<td style="text-align:right;">
1997
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1997/1998
</td>
<td style="text-align:right;">
1998
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
1998/1999
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
99.7
</td>
</tr>
<tr>
<td style="text-align:left;">
1999/2000
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2000/2001
</td>
<td style="text-align:right;">
2001
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2001/2002
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2002/2003
</td>
<td style="text-align:right;">
2003
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2003/2004
</td>
<td style="text-align:right;">
2004
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2004/2005
</td>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2005/2006
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2006/2007
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2007/2008
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2008/2009
</td>
<td style="text-align:right;">
2009
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009/2010
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2010/2011
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2011/2012
</td>
<td style="text-align:right;">
2012
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2012/2013
</td>
<td style="text-align:right;">
2013
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2013/2014
</td>
<td style="text-align:right;">
2014
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2014/2015
</td>
<td style="text-align:right;">
2015
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2015/2016
</td>
<td style="text-align:right;">
2016
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2016/2017
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2017/2018
</td>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2018/2019
</td>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
365
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2019/2020
</td>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
</tbody>
</table>
<p>We can see that we managed to fill almost all gaps, with only data for 1 day missing after the patching. It seems safe to use linear interpolation for such a short gap. The <code>fix_weather()</code> function can do this for us.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="filling-gaps-in-temperature-records.html#cb144-1" tabindex="-1"></a>Bonn_weather<span class="ot">&lt;-</span><span class="fu">fix_weather</span>(patched)</span></code></pre></div>
<div id="bias-correction-for-shorter-intervals" class="section level3 hasAnchor" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Bias-correction for shorter intervals<a href="filling-gaps-in-temperature-records.html#bias-correction-for-shorter-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the <code>patch_daily_temperatures</code> function, the bias correction is based on the average difference between the temperatures of a pair of weather stations over the entire year. It is possible, however, that the between-station bias varies throughout the year. We may then find that a particular station is a useful data source for temperatures in certain seasons but not in others. If we allow for different bias corrections during different parts of the year, we may also find that we can get better approximations, i.e. smaller biases than if we look at the entire year.</p>
<p>The <code>patch_daily_temps</code> (not <code>...temperatures</code>) function allows us to do this. As a default, it evaluates temperature records on a monthly basis, i.e. it makes separate between-station comparisons for the temperatures of each calendar month. It can then take separate decisions on whether a potential auxiliary station is a useful proxy for temperatures in this monthly interval, and it can apply month-specific bias correction.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="filling-gaps-in-temperature-records.html#cb145-1" tabindex="-1"></a>patched_monthly <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Bonn,</span>
<span id="cb145-2"><a href="filling-gaps-in-temperature-records.html#cb145-2" tabindex="-1"></a>                                     <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb145-3"><a href="filling-gaps-in-temperature-records.html#cb145-3" tabindex="-1"></a>                                     <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb145-4"><a href="filling-gaps-in-temperature-records.html#cb145-4" tabindex="-1"></a>                                     <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb145-5"><a href="filling-gaps-in-temperature-records.html#cb145-5" tabindex="-1"></a>                                     <span class="at">time_interval =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
<p>Here’s the finding for minimum temperatures for the NORVENICH station.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="filling-gaps-in-temperature-records.html#cb146-1" tabindex="-1"></a>patched_monthly<span class="sc">$</span>statistics<span class="sc">$</span>Tmin<span class="sc">$</span>NORVENICH</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-60">Table 11.23: </span><span id="tab:unnamed-chunk-60">Table 11.24: </span>Bias analysis table for the first station in the proxy station list, showing biases on a monthly level
</caption>
<thead>
<tr>
<th style="text-align:right;">
Interval
</th>
<th style="text-align:right;">
Total_days
</th>
<th style="text-align:right;">
Overlap_days
</th>
<th style="text-align:right;">
Mean_bias
</th>
<th style="text-align:right;">
Stdev_bias
</th>
<th style="text-align:right;">
Gaps_before
</th>
<th style="text-align:right;">
Filled
</th>
<th style="text-align:right;">
Gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
773
</td>
<td style="text-align:right;">
0.184
</td>
<td style="text-align:right;">
1.260
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
185
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
774
</td>
<td style="text-align:right;">
0.281
</td>
<td style="text-align:right;">
1.242
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
876
</td>
<td style="text-align:right;">
706
</td>
<td style="text-align:right;">
0.269
</td>
<td style="text-align:right;">
1.248
</td>
<td style="text-align:right;">
170
</td>
<td style="text-align:right;">
170
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
775
</td>
<td style="text-align:right;">
0.253
</td>
<td style="text-align:right;">
1.427
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
930
</td>
<td style="text-align:right;">
758
</td>
<td style="text-align:right;">
0.509
</td>
<td style="text-align:right;">
1.431
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
801
</td>
<td style="text-align:right;">
0.373
</td>
<td style="text-align:right;">
1.238
</td>
<td style="text-align:right;">
158
</td>
<td style="text-align:right;">
158
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
930
</td>
<td style="text-align:right;">
749
</td>
<td style="text-align:right;">
0.396
</td>
<td style="text-align:right;">
1.210
</td>
<td style="text-align:right;">
180
</td>
<td style="text-align:right;">
180
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
781
</td>
<td style="text-align:right;">
0.480
</td>
<td style="text-align:right;">
1.305
</td>
<td style="text-align:right;">
179
</td>
<td style="text-align:right;">
179
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
774
</td>
<td style="text-align:right;">
0.529
</td>
<td style="text-align:right;">
1.302
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
930
</td>
<td style="text-align:right;">
750
</td>
<td style="text-align:right;">
0.205
</td>
<td style="text-align:right;">
1.264
</td>
<td style="text-align:right;">
180
</td>
<td style="text-align:right;">
180
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
775
</td>
<td style="text-align:right;">
0.098
</td>
<td style="text-align:right;">
1.307
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
186
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
930
</td>
<td style="text-align:right;">
745
</td>
<td style="text-align:right;">
0.101
</td>
<td style="text-align:right;">
1.308
</td>
<td style="text-align:right;">
184
</td>
<td style="text-align:right;">
184
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We now see that the mean bias really varies quite a bit, so that we probably benefit from a month-specific bias correction.</p>
<p>The <code>time_interval</code> parameter of the <code>patch_daily_temps</code> function allows us to specify the interval we want to use. Intervals can be <code>month</code> or <code>week</code> but also multiples of these, such as <code>10 days</code> or <code>2 weeks</code>. Note that the function will start counting these intervals on 1st January in each year. This may lead to intervals at the end of the year that are smaller than the interval you selected (this generates warnings, as you can see below). Note also that the smaller these intervals get, the less data can be used for determining the bias. Especially for short time series, a very short interval may therefore not be desirable.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="filling-gaps-in-temperature-records.html#cb147-1" tabindex="-1"></a>patched_2weeks <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Bonn,</span>
<span id="cb147-2"><a href="filling-gaps-in-temperature-records.html#cb147-2" tabindex="-1"></a>                                    <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb147-3"><a href="filling-gaps-in-temperature-records.html#cb147-3" tabindex="-1"></a>                                    <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb147-4"><a href="filling-gaps-in-temperature-records.html#cb147-4" tabindex="-1"></a>                                    <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb147-5"><a href="filling-gaps-in-temperature-records.html#cb147-5" tabindex="-1"></a>                                    <span class="at">time_interval =</span> <span class="st">&quot;2 weeks&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
## The number of days in the last interval is often a lot smaller than in other
## intervals. Consider changing the time interval.
## Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
## The number of days in the last interval is often a lot smaller than in other
## intervals. Consider changing the time interval.
## Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
## The number of days in the last interval is often a lot smaller than in other
## intervals. Consider changing the time interval.</code></pre>
<p>To illustrate the effects of this, let’s create 5000 gaps in the Bonn weather record and fill them with proxy data using annual, monthly and bi-weekly intervals for the bias evaluation. We can plot the resulting errors with <code>ggplot2</code> using a violin plot.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="filling-gaps-in-temperature-records.html#cb149-1" tabindex="-1"></a>Gaps <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Bonn)), <span class="at">size =</span> <span class="dv">5000</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb149-2"><a href="filling-gaps-in-temperature-records.html#cb149-2" tabindex="-1"></a></span>
<span id="cb149-3"><a href="filling-gaps-in-temperature-records.html#cb149-3" tabindex="-1"></a>Bonn_gaps <span class="ot">&lt;-</span> Bonn <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">obs_Tmin=</span>Tmin,</span>
<span id="cb149-4"><a href="filling-gaps-in-temperature-records.html#cb149-4" tabindex="-1"></a>                             <span class="at">obs_Tmax=</span>Tmax)</span>
<span id="cb149-5"><a href="filling-gaps-in-temperature-records.html#cb149-5" tabindex="-1"></a>Bonn_gaps<span class="sc">$</span>Tmin[Gaps] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb149-6"><a href="filling-gaps-in-temperature-records.html#cb149-6" tabindex="-1"></a>Bonn_gaps<span class="sc">$</span>Tmax[Gaps] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb149-7"><a href="filling-gaps-in-temperature-records.html#cb149-7" tabindex="-1"></a></span>
<span id="cb149-8"><a href="filling-gaps-in-temperature-records.html#cb149-8" tabindex="-1"></a>patch_annual <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Bonn_gaps,</span>
<span id="cb149-9"><a href="filling-gaps-in-temperature-records.html#cb149-9" tabindex="-1"></a>                                  <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb149-10"><a href="filling-gaps-in-temperature-records.html#cb149-10" tabindex="-1"></a>                                  <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb149-11"><a href="filling-gaps-in-temperature-records.html#cb149-11" tabindex="-1"></a>                                  <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb149-12"><a href="filling-gaps-in-temperature-records.html#cb149-12" tabindex="-1"></a>                                  <span class="at">time_interval =</span> <span class="st">&quot;year&quot;</span>)</span>
<span id="cb149-13"><a href="filling-gaps-in-temperature-records.html#cb149-13" tabindex="-1"></a>patch_month <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Bonn_gaps,</span>
<span id="cb149-14"><a href="filling-gaps-in-temperature-records.html#cb149-14" tabindex="-1"></a>                                 <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb149-15"><a href="filling-gaps-in-temperature-records.html#cb149-15" tabindex="-1"></a>                                 <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb149-16"><a href="filling-gaps-in-temperature-records.html#cb149-16" tabindex="-1"></a>                                 <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb149-17"><a href="filling-gaps-in-temperature-records.html#cb149-17" tabindex="-1"></a>                                 <span class="at">time_interval =</span> <span class="st">&quot;month&quot;</span>)</span>
<span id="cb149-18"><a href="filling-gaps-in-temperature-records.html#cb149-18" tabindex="-1"></a>patch_2weeks <span class="ot">&lt;-</span> <span class="fu">patch_daily_temps</span>(<span class="at">weather =</span> Bonn_gaps,</span>
<span id="cb149-19"><a href="filling-gaps-in-temperature-records.html#cb149-19" tabindex="-1"></a>                                  <span class="at">patch_weather =</span> patch_weather,</span>
<span id="cb149-20"><a href="filling-gaps-in-temperature-records.html#cb149-20" tabindex="-1"></a>                                  <span class="at">max_mean_bias =</span> <span class="dv">1</span>,</span>
<span id="cb149-21"><a href="filling-gaps-in-temperature-records.html#cb149-21" tabindex="-1"></a>                                  <span class="at">max_stdev_bias =</span> <span class="dv">2</span>,</span>
<span id="cb149-22"><a href="filling-gaps-in-temperature-records.html#cb149-22" tabindex="-1"></a>                                  <span class="at">time_interval =</span> <span class="st">&quot;2 weeks&quot;</span>)</span>
<span id="cb149-23"><a href="filling-gaps-in-temperature-records.html#cb149-23" tabindex="-1"></a></span>
<span id="cb149-24"><a href="filling-gaps-in-temperature-records.html#cb149-24" tabindex="-1"></a>Bonn_gaps[,<span class="st">&quot;Tmin_annual&quot;</span>] <span class="ot">&lt;-</span> Bonn_gaps<span class="sc">$</span>obs_Tmin <span class="sc">-</span> patch_annual<span class="sc">$</span>weather<span class="sc">$</span>Tmin</span>
<span id="cb149-25"><a href="filling-gaps-in-temperature-records.html#cb149-25" tabindex="-1"></a>Bonn_gaps[,<span class="st">&quot;Tmax_annual&quot;</span>] <span class="ot">&lt;-</span> Bonn_gaps<span class="sc">$</span>obs_Tmax <span class="sc">-</span> patch_annual<span class="sc">$</span>weather<span class="sc">$</span>Tmax</span>
<span id="cb149-26"><a href="filling-gaps-in-temperature-records.html#cb149-26" tabindex="-1"></a>Bonn_gaps[,<span class="st">&quot;Tmin_month&quot;</span>] <span class="ot">&lt;-</span> Bonn_gaps<span class="sc">$</span>obs_Tmin <span class="sc">-</span> patch_month<span class="sc">$</span>weather<span class="sc">$</span>Tmin</span>
<span id="cb149-27"><a href="filling-gaps-in-temperature-records.html#cb149-27" tabindex="-1"></a>Bonn_gaps[,<span class="st">&quot;Tmax_month&quot;</span>] <span class="ot">&lt;-</span> Bonn_gaps<span class="sc">$</span>obs_Tmax <span class="sc">-</span> patch_month<span class="sc">$</span>weather<span class="sc">$</span>Tmax</span>
<span id="cb149-28"><a href="filling-gaps-in-temperature-records.html#cb149-28" tabindex="-1"></a>Bonn_gaps[,<span class="st">&quot;Tmin_2weeks&quot;</span>] <span class="ot">&lt;-</span> Bonn_gaps<span class="sc">$</span>obs_Tmin <span class="sc">-</span> patch_2weeks<span class="sc">$</span>weather<span class="sc">$</span>Tmin</span>
<span id="cb149-29"><a href="filling-gaps-in-temperature-records.html#cb149-29" tabindex="-1"></a>Bonn_gaps[,<span class="st">&quot;Tmax_2weeks&quot;</span>] <span class="ot">&lt;-</span> Bonn_gaps<span class="sc">$</span>obs_Tmax <span class="sc">-</span> patch_2weeks<span class="sc">$</span>weather<span class="sc">$</span>Tmax</span>
<span id="cb149-30"><a href="filling-gaps-in-temperature-records.html#cb149-30" tabindex="-1"></a></span>
<span id="cb149-31"><a href="filling-gaps-in-temperature-records.html#cb149-31" tabindex="-1"></a>Interval_eval <span class="ot">&lt;-</span> Bonn_gaps <span class="sc">%&gt;%</span></span>
<span id="cb149-32"><a href="filling-gaps-in-temperature-records.html#cb149-32" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Tmin)) <span class="sc">%&gt;%</span></span>
<span id="cb149-33"><a href="filling-gaps-in-temperature-records.html#cb149-33" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Tmin_annual<span class="sc">:</span>Tmax_2weeks) <span class="sc">%&gt;%</span></span>
<span id="cb149-34"><a href="filling-gaps-in-temperature-records.html#cb149-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type=</span><span class="fu">factor</span>(name,</span>
<span id="cb149-35"><a href="filling-gaps-in-temperature-records.html#cb149-35" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Tmin_annual&quot;</span>,</span>
<span id="cb149-36"><a href="filling-gaps-in-temperature-records.html#cb149-36" tabindex="-1"></a>                                <span class="st">&quot;Tmin_month&quot;</span>,</span>
<span id="cb149-37"><a href="filling-gaps-in-temperature-records.html#cb149-37" tabindex="-1"></a>                                <span class="st">&quot;Tmin_2weeks&quot;</span>,</span>
<span id="cb149-38"><a href="filling-gaps-in-temperature-records.html#cb149-38" tabindex="-1"></a>                                <span class="st">&quot;Tmax_annual&quot;</span>,</span>
<span id="cb149-39"><a href="filling-gaps-in-temperature-records.html#cb149-39" tabindex="-1"></a>                                <span class="st">&quot;Tmax_month&quot;</span>,</span>
<span id="cb149-40"><a href="filling-gaps-in-temperature-records.html#cb149-40" tabindex="-1"></a>                                <span class="st">&quot;Tmax_2weeks&quot;</span>)) )</span>
<span id="cb149-41"><a href="filling-gaps-in-temperature-records.html#cb149-41" tabindex="-1"></a></span>
<span id="cb149-42"><a href="filling-gaps-in-temperature-records.html#cb149-42" tabindex="-1"></a><span class="fu">ggplot</span>(Interval_eval,</span>
<span id="cb149-43"><a href="filling-gaps-in-temperature-records.html#cb149-43" tabindex="-1"></a>       <span class="fu">aes</span>(Type,value)) <span class="sc">+</span></span>
<span id="cb149-44"><a href="filling-gaps-in-temperature-records.html#cb149-44" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb149-45"><a href="filling-gaps-in-temperature-records.html#cb149-45" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Variable and bias evaluation interval&quot;</span>) <span class="sc">+</span></span>
<span id="cb149-46"><a href="filling-gaps-in-temperature-records.html#cb149-46" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Prediction error&quot;</span>)</span></code></pre></div>
<p><img src="Book_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>We can also evaluate the mean daily error.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="filling-gaps-in-temperature-records.html#cb150-1" tabindex="-1"></a>error_eval <span class="ot">&lt;-</span></span>
<span id="cb150-2"><a href="filling-gaps-in-temperature-records.html#cb150-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Tmin&quot;</span>,<span class="dv">3</span>),<span class="fu">rep</span>(<span class="st">&quot;Tmax&quot;</span>,<span class="dv">3</span>)),</span>
<span id="cb150-3"><a href="filling-gaps-in-temperature-records.html#cb150-3" tabindex="-1"></a>             <span class="at">Interval =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>,<span class="st">&quot;Month&quot;</span>,<span class="st">&quot;Two weeks&quot;</span>),<span class="dv">2</span>),</span>
<span id="cb150-4"><a href="filling-gaps-in-temperature-records.html#cb150-4" tabindex="-1"></a>             <span class="at">Error =</span> <span class="fu">c</span>(</span>
<span id="cb150-5"><a href="filling-gaps-in-temperature-records.html#cb150-5" tabindex="-1"></a>             <span class="fu">mean</span>(<span class="fu">abs</span>(Bonn_gaps<span class="sc">$</span>Tmin_annual[<span class="fu">is.na</span>(Bonn_gaps<span class="sc">$</span>Tmin)]),<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb150-6"><a href="filling-gaps-in-temperature-records.html#cb150-6" tabindex="-1"></a>             <span class="fu">mean</span>(<span class="fu">abs</span>(Bonn_gaps<span class="sc">$</span>Tmin_month[<span class="fu">is.na</span>(Bonn_gaps<span class="sc">$</span>Tmin)]),<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb150-7"><a href="filling-gaps-in-temperature-records.html#cb150-7" tabindex="-1"></a>             <span class="fu">mean</span>(<span class="fu">abs</span>(Bonn_gaps<span class="sc">$</span>Tmin_2weeks[<span class="fu">is.na</span>(Bonn_gaps<span class="sc">$</span>Tmin)]),<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb150-8"><a href="filling-gaps-in-temperature-records.html#cb150-8" tabindex="-1"></a>             <span class="fu">mean</span>(<span class="fu">abs</span>(Bonn_gaps<span class="sc">$</span>Tmax_annual[<span class="fu">is.na</span>(Bonn_gaps<span class="sc">$</span>Tmin)]),<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb150-9"><a href="filling-gaps-in-temperature-records.html#cb150-9" tabindex="-1"></a>             <span class="fu">mean</span>(<span class="fu">abs</span>(Bonn_gaps<span class="sc">$</span>Tmax_month[<span class="fu">is.na</span>(Bonn_gaps<span class="sc">$</span>Tmin)]),<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb150-10"><a href="filling-gaps-in-temperature-records.html#cb150-10" tabindex="-1"></a>             <span class="fu">mean</span>(<span class="fu">abs</span>(Bonn_gaps<span class="sc">$</span>Tmax_2weeks[<span class="fu">is.na</span>(Bonn_gaps<span class="sc">$</span>Tmin)]),<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb150-11"><a href="filling-gaps-in-temperature-records.html#cb150-11" tabindex="-1"></a>             )</span></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="filling-gaps-in-temperature-records.html#cb151-1" tabindex="-1"></a>error_eval</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-65">Table 11.25: </span><span id="tab:unnamed-chunk-65">Table 11.26: </span>Mean absolute prediction error for minimum and maximum
temperature when using different time intervals as a basis for correcting
for between-station biases
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Interval
</th>
<th style="text-align:right;">
Error
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:left;">
Year
</td>
<td style="text-align:right;">
1.0051829
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:left;">
Month
</td>
<td style="text-align:right;">
0.9977331
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmin
</td>
<td style="text-align:left;">
Two weeks
</td>
<td style="text-align:right;">
1.0006110
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:left;">
Year
</td>
<td style="text-align:right;">
0.8260267
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:left;">
Month
</td>
<td style="text-align:right;">
0.8030568
</td>
</tr>
<tr>
<td style="text-align:left;">
Tmax
</td>
<td style="text-align:left;">
Two weeks
</td>
<td style="text-align:right;">
0.8058152
</td>
</tr>
</tbody>
</table>
<p>As cou can see, the improvement wasn’t very impressive here, possibly because the stations we used are quite close to each other and the weather doesn’t differ much between them.</p>
</div>
<div id="saving-the-data-for-later" class="section level3 hasAnchor" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> Saving the data for later<a href="filling-gaps-in-temperature-records.html#saving-the-data-for-later" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we should make sure that we save one of these files for later. I’ll choose the dataset where we based the bias correction on monthly intervals. We still need to interpolate the one missing day, before we can save this.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="filling-gaps-in-temperature-records.html#cb152-1" tabindex="-1"></a>monthly_bias_fixed <span class="ot">&lt;-</span> <span class="fu">fix_weather</span>(patched_monthly)</span></code></pre></div>
<p>Now we have a fairly convincing long-term record (from 1990 to 2020) for Bonn, with no more gaps remaining. Let’s save this now.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="filling-gaps-in-temperature-records.html#cb153-1" tabindex="-1"></a><span class="fu">write.csv</span>(monthly_bias_fixed<span class="sc">$</span>weather,</span>
<span id="cb153-2"><a href="filling-gaps-in-temperature-records.html#cb153-2" tabindex="-1"></a>          <span class="st">&quot;data/Bonn_weather.csv&quot;</span>)</span></code></pre></div>
<p>Note that I only saved the <code>weather</code> element. This is a data.frame that can easily be saved as a spreadsheet table (<code>.csv</code> file). We can also save lists (including the <code>QC</code> element in this case), but that’s a bit more complicated, so let’s save this for later.</p>
</div>
</div>
<div id="filling-gaps-in-hourly-records" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Filling gaps in hourly records<a href="filling-gaps-in-temperature-records.html#filling-gaps-in-hourly-records" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When it comes to gaps, hourly records are a lot harder to handle, because linear interpolation usually isn’t an option. This works for very short gaps only, but it’s probably quite obvious that for gaps that extend over multiple days, you can’t just connect the start and end points with a straight line. This makes it very hard to make use of hourly records, even when they are available. Since I’ve come across this problem a few times, I thought of a procedure that can do this <span class="citation">(<a href="#ref-luedeling_interpolating_2018">Luedeling, 2018</a>)</span>.</p>
<p>Sometimes we have actual records of hourly temperatures. While this is preferable, in principle, to deriving hourly data from daily records, it may cause problems when the record isn’t complete. An example of such a record is the <code>Winters_hours_gaps</code> dataset contained in <code>chillR</code>. Such situations arise quite often, because temperature loggers can temporarily fail for many reasons. Let’s first look at what happens if we simply use linear interpolation:</p>
<p><img src="Book_files/figure-html/hourly_linear-1.png" width="672" /></p>
<p>In this interpolation, some daytime or nighttime cycles were missed entirely, which can lead to substantial errors when calculating agroclimatic metrics, such as chill or heat stress, that are of particular concern during the warmest and coolest parts of the day.</p>
<p><code>chillR</code>’s <code>interpolate_gaps_hourly()</code> function provides an algorithm that can produce credible and continuous hourly records from such a patchy dataset. It combines several of the elements described above, but also adds functionality to derive daily temperature extremes from hourly data that were recorded. Without going into too much detail, here is the rough mode of operation:</p>
<ul>
<li><p>Express temperatures for each hour as a function of daily temperature extremes using the functions of <span class="citation">Linvill (<a href="#ref-linvill1990calculating">1990</a>)</span>. According to this idealized curve, all hourly temperatures can be expressed as a function of Tmin and Tmax on the previous, same or next day of the temperature record (depending on which hour is of interest). For a day with a complete record, 24 equations can be set up.</p></li>
<li><p>For each daily temperature extreme, empirically solve the system of all equations that contain the respective Tmin or Tmax variable (this is only attempted, when a minimum of 5 equations are available, to avoid spurious results).</p></li>
<li><p>Close gaps in the resulting dataset of daily Tmin and Tmax using data from proxy stations or, as a last resort, linear interpolation.</p></li>
<li><p>Compute idealized temperature curves from the now continuous record of daily Tmin and Tmax values.</p></li>
<li><p>Calculate the difference between recorded temperatures and this idealized curve.</p></li>
<li><p>Linearly interpolate this difference and add then result to the idealized temperature curve.</p></li>
</ul>
<p>The following code calls this function for the Winters dataset, using daily data from a nearby station of the California Irrigation Management Information System (CIMIS) as a proxy. This is retrieved with the <code>handle_cimis()</code> function, which works similarly to the <code>handle_gsod()</code> function described above. Note that the CIMIS database seems to have occasional connectivity problems, and they’ve at least once made changes to their data storage system that required changes to the <code>handle_cimis</code> function. So it’s possible that the process times out or returns an error.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="filling-gaps-in-temperature-records.html#cb154-1" tabindex="-1"></a>stations <span class="ot">&lt;-</span> <span class="fu">handle_cimis</span>(<span class="st">&quot;list_stations&quot;</span>,</span>
<span id="cb154-2"><a href="filling-gaps-in-temperature-records.html#cb154-2" tabindex="-1"></a>                         <span class="at">location =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">122</span>,<span class="fl">38.5</span>))</span>
<span id="cb154-3"><a href="filling-gaps-in-temperature-records.html#cb154-3" tabindex="-1"></a>downloaded_winters <span class="ot">&lt;-</span> <span class="fu">handle_cimis</span>(<span class="st">&quot;download_weather&quot;</span>,</span>
<span id="cb154-4"><a href="filling-gaps-in-temperature-records.html#cb154-4" tabindex="-1"></a>                                   stations<span class="sc">$</span>chillR_code[<span class="dv">2</span>],</span>
<span id="cb154-5"><a href="filling-gaps-in-temperature-records.html#cb154-5" tabindex="-1"></a>                                   <span class="at">time_interval =</span> <span class="fu">c</span>(<span class="dv">2008</span>,<span class="dv">2008</span>))</span>
<span id="cb154-6"><a href="filling-gaps-in-temperature-records.html#cb154-6" tabindex="-1"></a>winters_daily <span class="ot">&lt;-</span> <span class="fu">handle_cimis</span>(downloaded_winters)<span class="sc">$</span>weather</span></code></pre></div>
<p>Here’s what the dataset looks like:</p>
<table class="table table-striped" style="font-size: 10px; ">
<thead>
<tr>
<th style="text-align:right;">
Year
</th>
<th style="text-align:right;">
Month
</th>
<th style="text-align:right;">
Day
</th>
<th style="text-align:right;">
Tmin
</th>
<th style="text-align:right;">
Tmax
</th>
<th style="text-align:right;">
Tmean
</th>
<th style="text-align:right;">
Prec
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1.7
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
12.2
</td>
<td style="text-align:right;">
6.9
</td>
<td style="text-align:right;">
12.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
8.0
</td>
<td style="text-align:right;">
11.0
</td>
<td style="text-align:right;">
9.2
</td>
<td style="text-align:right;">
132.8
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.3
</td>
<td style="text-align:right;">
9.5
</td>
<td style="text-align:right;">
7.2
</td>
<td style="text-align:right;">
10.3
</td>
</tr>
</tbody>
</table>
<p>And here is the call of the <code>interpolate_gaps_hourly()</code> function:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="filling-gaps-in-temperature-records.html#cb155-1" tabindex="-1"></a>to_interp <span class="ot">&lt;-</span> Winters_hours_gaps</span>
<span id="cb155-2"><a href="filling-gaps-in-temperature-records.html#cb155-2" tabindex="-1"></a>to_interp[,<span class="st">&quot;Temp_recorded&quot;</span>] <span class="ot">&lt;-</span> to_interp[,<span class="st">&quot;Temp&quot;</span>]</span>
<span id="cb155-3"><a href="filling-gaps-in-temperature-records.html#cb155-3" tabindex="-1"></a>to_interp[,<span class="st">&quot;Temp&quot;</span>] <span class="ot">&lt;-</span> to_interp[,<span class="st">&quot;Temp_gaps&quot;</span>]</span>
<span id="cb155-4"><a href="filling-gaps-in-temperature-records.html#cb155-4" tabindex="-1"></a>interp <span class="ot">&lt;-</span> <span class="fu">interpolate_gaps_hourly</span>(<span class="at">hourtemps =</span> to_interp,</span>
<span id="cb155-5"><a href="filling-gaps-in-temperature-records.html#cb155-5" tabindex="-1"></a>                                  <span class="at">latitude =</span> <span class="fl">38.5</span>,</span>
<span id="cb155-6"><a href="filling-gaps-in-temperature-records.html#cb155-6" tabindex="-1"></a>                                  <span class="at">daily_temps =</span> <span class="fu">list</span>(<span class="at">Winters=</span>winters_daily))</span></code></pre></div>
<p>The resulting dataset has two elements: <code>$weather</code> and <code>daily_patch_report</code>. Let’s first look at the <code>daily_patch_report</code> element:</p>
<table class="table table-striped" style="font-size: 10px; ">
<thead>
<tr>
<th style="text-align:right;">
Var
</th>
<th style="text-align:right;">
Proxy
</th>
<th style="text-align:right;">
mean_bias
</th>
<th style="text-align:right;">
stdev_bias
</th>
<th style="text-align:right;">
filled
</th>
<th style="text-align:right;">
gaps_remain
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
Tmin
</td>
<td style="text-align:right;">
solved
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
193
</td>
<td style="text-align:right;">
61
</td>
</tr>
<tr>
<td style="text-align:right;">
Tmin
</td>
<td style="text-align:right;">
Winters
</td>
<td style="text-align:right;">
0.282
</td>
<td style="text-align:right;">
1.908
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
Tmin
</td>
<td style="text-align:right;">
interpolated
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
Tmax
</td>
<td style="text-align:right;">
solved
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
204
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:right;">
Tmax
</td>
<td style="text-align:right;">
Winters
</td>
<td style="text-align:right;">
-1.835
</td>
<td style="text-align:right;">
2.393
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
Tmax
</td>
<td style="text-align:right;">
interpolated
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>This table contains information on how many gaps in the daily record were filled by solving the system of hourly equations (‘solved’), how many Tmin and Tmax values were derived from proxy stations (listed by name, if names were provided in the call to <code>interpolate_gaps_hourly</code>; otherwise as station_x), and how many were filled by linear interpolation (this option can be turned off using the <code>interpolate_remaining</code> parameter). For proxy stations, it also provides the bias in mean Tmin and Tmax, which has been corrected, as well as the bias in the standard deviation of Tmin and Tmax (which was <em>not</em> corrected).</p>
<p>The <code>$weather</code> element of the interpolation result contains the table of interpolated temperatures.</p>
<table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
Year
</th>
<th style="text-align:right;">
Month
</th>
<th style="text-align:right;">
Day
</th>
<th style="text-align:right;">
Hour
</th>
<th style="text-align:right;">
interpolated
</th>
<th style="text-align:right;">
Tmax_source
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
21.86700
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
21.60400
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
20.07900
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
17.34400
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
13.93000
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
11.92900
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
11.84718
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
11.76536
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11.68355
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11.60173
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11.51991
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11.43809
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.35627
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
11.27445
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11.19264
</td>
<td style="text-align:right;">
solved
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11.11082
</td>
<td style="text-align:right;">
solved
</td>
</tr>
</tbody>
</table>
<p>Here’s a plot of part of the data:</p>
<p><img src="Book_files/figure-html/hourly_interpolation-1.png" width="672" /></p>
<p>This illustration shows that the <code>interpolate_gaps_hourly()</code> function produced a pretty good approximation (red lines) to the actual temperatures (gray line).</p>
<div id="accuracy-assessment" class="section level3 hasAnchor" number="11.4.1">
<h3><span class="header-section-number">11.4.1</span> Accuracy assessment<a href="filling-gaps-in-temperature-records.html#accuracy-assessment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since the actual hourly temperatures are known, we can evaluate the accuracy of the predictions produced by the various interpolation methods. A common measure for validating predictions is the Root Mean Square Error of the Prediction (RMSEP):</p>
<p><span class="math display">\[RMSEP=\sqrt{\frac{\sum_{i=1}^n(\hat{y}_i-y_i)^2}{n}}\]</span>, with <span class="math inline">\(\hat{y}_i\)</span> being the observed values, <span class="math inline">\(y_i\)</span> the predicted values, and <span class="math inline">\(n\)</span> the number of values.</p>
<p>The RMSEP provides an indication of how far each predicted value deviates, on average, from the actual values. It is, however, quite difficult to interpret RMSEP values alone, because whether they indicate a good or poor model fit depends on how variable the actual values are. For instance, an RMSEP of 5 days for a phenology model (which is close to, but not quite the same as a mean error of 5 days), could indicate a very good model, if observed dates vary by several weeks or months (e.g. for bloom dates of deciduous trees), but a terrible model, if the phenological stage of interest occurs on the same day every year (e.g. the ‘phenological’ event of candles lighting up on ‘festive indoor conifers’).</p>
<p>This is why it makes sense to include in such accuracy assessment the variation in observed values. This can be achieved by dividing the standard deviation of the observed data by the RMSEP to calculate the Residual Prediction Deviation (RPD):</p>
<p><span class="math display">\[RPD=\frac{sd_y}{RMSEP}\]</span>
This equation contains the RMSEP as computed above as well as the standard deviation of the observed values from their mean, defined as</p>
<p><span class="math display">\[sd_y=\sqrt{\frac{\sum_{i=1}^n(y_i-\bar{y})^2}{n-1}}\]</span></p>
<p>, with <span class="math inline">\(\bar{y}\)</span> being the mean over all observations.</p>
<p>The RPD is more useful than the RMSEP, but its use of the standard deviation can be a problem, when actual values of <span class="math inline">\(y\)</span> aren’t normally distributed (then the standard deviation can be a poor measure of variation). A more robust approach is use the interquartile range instead of the standard deviation. This metric is called the Ratio of Performance to InterQuartile distance (RPIQ):</p>
<p><span class="math display">\[RPIQ=\frac{IQ}{RMSEP}\]</span></p>
<p>IQ is calculated by subtracting the 75<sup>th</sup> percentile of the distribution of all <span class="math inline">\(y\)</span> from the 25<sup>th</sup> percentile.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="filling-gaps-in-temperature-records.html#cb156-1" tabindex="-1"></a><span class="fu">require</span>(stats)</span>
<span id="cb156-2"><a href="filling-gaps-in-temperature-records.html#cb156-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb156-3"><a href="filling-gaps-in-temperature-records.html#cb156-3" tabindex="-1"></a>IQ <span class="ot">&lt;-</span> <span class="fu">quantile</span>(y)[<span class="dv">4</span>] <span class="sc">-</span> <span class="fu">quantile</span>(y)[<span class="dv">2</span>]</span></code></pre></div>
<p>The RPIQ score is a bit harder to evaluate than the RMSEP, with different quality thresholds in use and a very high context dependency. Quite commonly, values above 2 are considered ‘good’ or even ‘excellent’, though some studies use substantially higher thresholds (up to 8 for excellence).</p>
<p>Since the RPIQ makes no assumption about the distribution of <span class="math inline">\(y\)</span>, let’s use this for assessing the accuracy of the various interpolation methods. We have a total of four methods to evaluate:</p>
<ul>
<li><strong>idealized</strong> temperature curves from <strong>daily</strong> records of Tmin and Tmax, based on records from a nearby weather station</li>
<li><strong>idealized</strong> temperature curves from <strong>daily</strong> records of Tmin and Tmax, based on records from <strong>the same location</strong><br />
</li>
<li><strong>linear</strong> interpolation of <strong>hourly</strong> temperatures</li>
<li>interpolation of <strong>hourly</strong> temperatures with <strong>interpolate_gaps_hourly</strong></li>
</ul>
<p>For option 2, we first have to generate a dataset of daily minimum and maximum temperatures from the hourly records. We can do this with the <code>make_all_day_table()</code> function (see documentation for this function for details).</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="filling-gaps-in-temperature-records.html#cb157-1" tabindex="-1"></a>inter <span class="ot">&lt;-</span> interp<span class="sc">$</span>weather</span>
<span id="cb157-2"><a href="filling-gaps-in-temperature-records.html#cb157-2" tabindex="-1"></a>inter[,<span class="st">&quot;DATE&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">ISOdate</span>(inter<span class="sc">$</span>Year,</span>
<span id="cb157-3"><a href="filling-gaps-in-temperature-records.html#cb157-3" tabindex="-1"></a>                          inter<span class="sc">$</span>Month,</span>
<span id="cb157-4"><a href="filling-gaps-in-temperature-records.html#cb157-4" tabindex="-1"></a>                          inter<span class="sc">$</span>Day,</span>
<span id="cb157-5"><a href="filling-gaps-in-temperature-records.html#cb157-5" tabindex="-1"></a>                          inter<span class="sc">$</span>Hour)</span>
<span id="cb157-6"><a href="filling-gaps-in-temperature-records.html#cb157-6" tabindex="-1"></a></span>
<span id="cb157-7"><a href="filling-gaps-in-temperature-records.html#cb157-7" tabindex="-1"></a>orchard_extremes <span class="ot">&lt;-</span> <span class="fu">make_all_day_table</span>(inter,</span>
<span id="cb157-8"><a href="filling-gaps-in-temperature-records.html#cb157-8" tabindex="-1"></a>                                       <span class="at">timestep =</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb157-9"><a href="filling-gaps-in-temperature-records.html#cb157-9" tabindex="-1"></a>                                       <span class="at">input_timestep =</span> <span class="st">&quot;hour&quot;</span>)</span></code></pre></div>
<p>Let’s first look at the performance of the four methods for the periods that were missing in the hourly temperature record:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="filling-gaps-in-temperature-records.html#cb158-1" tabindex="-1"></a>winters_hours <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(<span class="fu">fix_weather</span>(winters_daily),</span>
<span id="cb158-2"><a href="filling-gaps-in-temperature-records.html#cb158-2" tabindex="-1"></a>                                    <span class="at">latitude =</span> <span class="dv">38</span>)<span class="sc">$</span>hourtemps</span>
<span id="cb158-3"><a href="filling-gaps-in-temperature-records.html#cb158-3" tabindex="-1"></a></span>
<span id="cb158-4"><a href="filling-gaps-in-temperature-records.html#cb158-4" tabindex="-1"></a>start_hour_winters <span class="ot">&lt;-</span> <span class="fu">which</span>(winters_hours<span class="sc">$</span>Year <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Year,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-5"><a href="filling-gaps-in-temperature-records.html#cb158-5" tabindex="-1"></a>                              winters_hours<span class="sc">$</span>Month <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Month,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-6"><a href="filling-gaps-in-temperature-records.html#cb158-6" tabindex="-1"></a>                              winters_hours<span class="sc">$</span>Day <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Day,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-7"><a href="filling-gaps-in-temperature-records.html#cb158-7" tabindex="-1"></a>                              winters_hours<span class="sc">$</span>Hour <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Hour,<span class="dv">1</span>))</span>
<span id="cb158-8"><a href="filling-gaps-in-temperature-records.html#cb158-8" tabindex="-1"></a></span>
<span id="cb158-9"><a href="filling-gaps-in-temperature-records.html#cb158-9" tabindex="-1"></a>end_hour_winters <span class="ot">&lt;-</span> <span class="fu">which</span>(winters_hours<span class="sc">$</span>Year <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Year,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-10"><a href="filling-gaps-in-temperature-records.html#cb158-10" tabindex="-1"></a>                            winters_hours<span class="sc">$</span>Month <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Month,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-11"><a href="filling-gaps-in-temperature-records.html#cb158-11" tabindex="-1"></a>                            winters_hours<span class="sc">$</span>Day <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Day,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-12"><a href="filling-gaps-in-temperature-records.html#cb158-12" tabindex="-1"></a>                            winters_hours<span class="sc">$</span>Hour <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Hour,<span class="dv">1</span>))</span>
<span id="cb158-13"><a href="filling-gaps-in-temperature-records.html#cb158-13" tabindex="-1"></a></span>
<span id="cb158-14"><a href="filling-gaps-in-temperature-records.html#cb158-14" tabindex="-1"></a>orchard_hours <span class="ot">&lt;-</span> <span class="fu">stack_hourly_temps</span>(orchard_extremes,</span>
<span id="cb158-15"><a href="filling-gaps-in-temperature-records.html#cb158-15" tabindex="-1"></a>                                    <span class="at">latitude =</span> <span class="dv">38</span>)<span class="sc">$</span>hourtemps</span>
<span id="cb158-16"><a href="filling-gaps-in-temperature-records.html#cb158-16" tabindex="-1"></a></span>
<span id="cb158-17"><a href="filling-gaps-in-temperature-records.html#cb158-17" tabindex="-1"></a>start_hour_orchard <span class="ot">&lt;-</span> <span class="fu">which</span>(orchard_hours<span class="sc">$</span>Year <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Year,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-18"><a href="filling-gaps-in-temperature-records.html#cb158-18" tabindex="-1"></a>                              orchard_hours<span class="sc">$</span>Month <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Month,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-19"><a href="filling-gaps-in-temperature-records.html#cb158-19" tabindex="-1"></a>                              orchard_hours<span class="sc">$</span>Day <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Day,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-20"><a href="filling-gaps-in-temperature-records.html#cb158-20" tabindex="-1"></a>                              orchard_hours<span class="sc">$</span>Hour <span class="sc">==</span> <span class="fu">head</span>(inter<span class="sc">$</span>Hour,<span class="dv">1</span>))</span>
<span id="cb158-21"><a href="filling-gaps-in-temperature-records.html#cb158-21" tabindex="-1"></a></span>
<span id="cb158-22"><a href="filling-gaps-in-temperature-records.html#cb158-22" tabindex="-1"></a>end_hour_orchard <span class="ot">&lt;-</span> <span class="fu">which</span>(orchard_hours<span class="sc">$</span>Year <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Year,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-23"><a href="filling-gaps-in-temperature-records.html#cb158-23" tabindex="-1"></a>                            orchard_hours<span class="sc">$</span>Month <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Month,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-24"><a href="filling-gaps-in-temperature-records.html#cb158-24" tabindex="-1"></a>                            orchard_hours<span class="sc">$</span>Day <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Day,<span class="dv">1</span>)<span class="sc">&amp;</span></span>
<span id="cb158-25"><a href="filling-gaps-in-temperature-records.html#cb158-25" tabindex="-1"></a>                            orchard_hours<span class="sc">$</span>Hour <span class="sc">==</span> <span class="fu">tail</span>(inter<span class="sc">$</span>Hour,<span class="dv">1</span>))</span>
<span id="cb158-26"><a href="filling-gaps-in-temperature-records.html#cb158-26" tabindex="-1"></a></span>
<span id="cb158-27"><a href="filling-gaps-in-temperature-records.html#cb158-27" tabindex="-1"></a>observed <span class="ot">&lt;-</span> inter<span class="sc">$</span>Temp_recorded</span>
<span id="cb158-28"><a href="filling-gaps-in-temperature-records.html#cb158-28" tabindex="-1"></a>option1 <span class="ot">&lt;-</span> winters_hours<span class="sc">$</span>Temp[start_hour_winters<span class="sc">:</span>end_hour_winters]</span>
<span id="cb158-29"><a href="filling-gaps-in-temperature-records.html#cb158-29" tabindex="-1"></a>option2 <span class="ot">&lt;-</span> orchard_hours<span class="sc">$</span>Temp[start_hour_orchard<span class="sc">:</span>end_hour_orchard]</span>
<span id="cb158-30"><a href="filling-gaps-in-temperature-records.html#cb158-30" tabindex="-1"></a>option3 <span class="ot">&lt;-</span> <span class="fu">interpolate_gaps</span>(inter<span class="sc">$</span>Temp_gaps)<span class="sc">$</span>interp</span>
<span id="cb158-31"><a href="filling-gaps-in-temperature-records.html#cb158-31" tabindex="-1"></a>option4 <span class="ot">&lt;-</span> inter<span class="sc">$</span>Temp</span>
<span id="cb158-32"><a href="filling-gaps-in-temperature-records.html#cb158-32" tabindex="-1"></a></span>
<span id="cb158-33"><a href="filling-gaps-in-temperature-records.html#cb158-33" tabindex="-1"></a>eval_table <span class="ot">&lt;-</span></span>
<span id="cb158-34"><a href="filling-gaps-in-temperature-records.html#cb158-34" tabindex="-1"></a>  eval_table_gaps <span class="ot">&lt;-</span></span>
<span id="cb158-35"><a href="filling-gaps-in-temperature-records.html#cb158-35" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Option =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb158-36"><a href="filling-gaps-in-temperature-records.html#cb158-36" tabindex="-1"></a>             <span class="at">Input_data =</span> <span class="fu">c</span>(<span class="st">&quot;daily&quot;</span>,<span class="st">&quot;daily&quot;</span>,<span class="st">&quot;hourly&quot;</span>,<span class="st">&quot;hourly&quot;</span>),</span>
<span id="cb158-37"><a href="filling-gaps-in-temperature-records.html#cb158-37" tabindex="-1"></a>             <span class="at">Interpolation_method =</span> <span class="fu">c</span>(<span class="st">&quot;from proxy&quot;</span>,<span class="st">&quot;local extremes&quot;</span>,</span>
<span id="cb158-38"><a href="filling-gaps-in-temperature-records.html#cb158-38" tabindex="-1"></a>                                      <span class="st">&quot;linear&quot;</span>,<span class="st">&quot;hourly interpolation&quot;</span>),</span>
<span id="cb158-39"><a href="filling-gaps-in-temperature-records.html#cb158-39" tabindex="-1"></a>             <span class="at">RMSEP =</span> <span class="cn">NA</span>,</span>
<span id="cb158-40"><a href="filling-gaps-in-temperature-records.html#cb158-40" tabindex="-1"></a>             <span class="at">RPIQ =</span> <span class="cn">NA</span>)</span>
<span id="cb158-41"><a href="filling-gaps-in-temperature-records.html#cb158-41" tabindex="-1"></a></span>
<span id="cb158-42"><a href="filling-gaps-in-temperature-records.html#cb158-42" tabindex="-1"></a>observed_gaps <span class="ot">&lt;-</span> observed[<span class="fu">which</span>(<span class="fu">is.na</span>(inter<span class="sc">$</span>Temp_gaps))]</span>
<span id="cb158-43"><a href="filling-gaps-in-temperature-records.html#cb158-43" tabindex="-1"></a>option1_gaps <span class="ot">&lt;-</span> option1[<span class="fu">which</span>(<span class="fu">is.na</span>(inter<span class="sc">$</span>Temp_gaps))]</span>
<span id="cb158-44"><a href="filling-gaps-in-temperature-records.html#cb158-44" tabindex="-1"></a>option2_gaps <span class="ot">&lt;-</span> option2[<span class="fu">which</span>(<span class="fu">is.na</span>(inter<span class="sc">$</span>Temp_gaps))]</span>
<span id="cb158-45"><a href="filling-gaps-in-temperature-records.html#cb158-45" tabindex="-1"></a>option3_gaps <span class="ot">&lt;-</span> option3[<span class="fu">which</span>(<span class="fu">is.na</span>(inter<span class="sc">$</span>Temp_gaps))]</span>
<span id="cb158-46"><a href="filling-gaps-in-temperature-records.html#cb158-46" tabindex="-1"></a>option4_gaps <span class="ot">&lt;-</span> option4[<span class="fu">which</span>(<span class="fu">is.na</span>(inter<span class="sc">$</span>Temp_gaps))]</span>
<span id="cb158-47"><a href="filling-gaps-in-temperature-records.html#cb158-47" tabindex="-1"></a></span>
<span id="cb158-48"><a href="filling-gaps-in-temperature-records.html#cb158-48" tabindex="-1"></a>eval_table_gaps[,<span class="st">&quot;RMSEP&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">RMSEP</span>(option1_gaps, observed_gaps),</span>
<span id="cb158-49"><a href="filling-gaps-in-temperature-records.html#cb158-49" tabindex="-1"></a>                                     <span class="fu">RMSEP</span>(option2_gaps, observed_gaps),</span>
<span id="cb158-50"><a href="filling-gaps-in-temperature-records.html#cb158-50" tabindex="-1"></a>                                     <span class="fu">RMSEP</span>(option3_gaps, observed_gaps),</span>
<span id="cb158-51"><a href="filling-gaps-in-temperature-records.html#cb158-51" tabindex="-1"></a>                                     <span class="fu">RMSEP</span>(option4_gaps, observed_gaps)),</span>
<span id="cb158-52"><a href="filling-gaps-in-temperature-records.html#cb158-52" tabindex="-1"></a>                                   <span class="dv">1</span>)</span>
<span id="cb158-53"><a href="filling-gaps-in-temperature-records.html#cb158-53" tabindex="-1"></a></span>
<span id="cb158-54"><a href="filling-gaps-in-temperature-records.html#cb158-54" tabindex="-1"></a>eval_table_gaps[,<span class="st">&quot;RPIQ&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">RPIQ</span>(option1_gaps, observed_gaps),</span>
<span id="cb158-55"><a href="filling-gaps-in-temperature-records.html#cb158-55" tabindex="-1"></a>                                    <span class="fu">RPIQ</span>(option2_gaps, observed_gaps),</span>
<span id="cb158-56"><a href="filling-gaps-in-temperature-records.html#cb158-56" tabindex="-1"></a>                                    <span class="fu">RPIQ</span>(option3_gaps, observed_gaps),</span>
<span id="cb158-57"><a href="filling-gaps-in-temperature-records.html#cb158-57" tabindex="-1"></a>                                    <span class="fu">RPIQ</span>(option4_gaps, observed_gaps)),</span>
<span id="cb158-58"><a href="filling-gaps-in-temperature-records.html#cb158-58" tabindex="-1"></a>                                  <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="filling-gaps-in-temperature-records.html#cb159-1" tabindex="-1"></a>eval_table_gaps</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<thead>
<tr>
<th style="text-align:right;">
Option
</th>
<th style="text-align:left;">
Input_data
</th>
<th style="text-align:left;">
Interpolation_method
</th>
<th style="text-align:right;">
RMSEP
</th>
<th style="text-align:right;">
RPIQ
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
daily
</td>
<td style="text-align:left;">
from proxy
</td>
<td style="text-align:right;">
2.6
</td>
<td style="text-align:right;">
4.1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
daily
</td>
<td style="text-align:left;">
local extremes
</td>
<td style="text-align:right;">
2.1
</td>
<td style="text-align:right;">
5.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
5.3
</td>
<td style="text-align:right;">
2.0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
hourly interpolation
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
5.4
</td>
</tr>
</tbody>
</table>
<p>This table shows that the <code>interpolate_gaps_hourly</code> function produced the best results, with an RMSEP of 2 and an RPIQ of 5.4. It’s interesting to note that option 3, where hourly records collected in the orchard were interpolated linearly, produced the worst fit. This highlights that, at least in this case, using an idealized temperature curve to close gaps in daily temperatures from the orchard (option 2) and even from the proxy station (option 1) produced more accurate results. Naturally, the quality of the latter approach will depend on the similarity between weather at the proxy station and in the orchard (in this case, this should be quite similar).</p>
<p>Restricting the comparison to only the gaps in the record is a bit unfair, because of course records produced by option 3 (linear interpolation of hourly records from the orchard) are completely accurate for hours, when temperatures were recorded. So let’s also compare the relative performance of the four methods across all hours of the record.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="filling-gaps-in-temperature-records.html#cb160-1" tabindex="-1"></a>eval_table <span class="ot">&lt;-</span></span>
<span id="cb160-2"><a href="filling-gaps-in-temperature-records.html#cb160-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">Option =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb160-3"><a href="filling-gaps-in-temperature-records.html#cb160-3" tabindex="-1"></a>             <span class="at">Input_data =</span> <span class="fu">c</span>(<span class="st">&quot;daily&quot;</span>,<span class="st">&quot;daily&quot;</span>,<span class="st">&quot;hourly&quot;</span>,<span class="st">&quot;hourly&quot;</span>),</span>
<span id="cb160-4"><a href="filling-gaps-in-temperature-records.html#cb160-4" tabindex="-1"></a>             <span class="at">Interpolation_method =</span> <span class="fu">c</span>(<span class="st">&quot;from proxy&quot;</span>,<span class="st">&quot;local extremes&quot;</span>,</span>
<span id="cb160-5"><a href="filling-gaps-in-temperature-records.html#cb160-5" tabindex="-1"></a>                                      <span class="st">&quot;linear&quot;</span>,<span class="st">&quot;hourly interpolation&quot;</span>),</span>
<span id="cb160-6"><a href="filling-gaps-in-temperature-records.html#cb160-6" tabindex="-1"></a>             <span class="at">RMSEP =</span> <span class="cn">NA</span>,</span>
<span id="cb160-7"><a href="filling-gaps-in-temperature-records.html#cb160-7" tabindex="-1"></a>             <span class="at">RPIQ =</span> <span class="cn">NA</span>)</span>
<span id="cb160-8"><a href="filling-gaps-in-temperature-records.html#cb160-8" tabindex="-1"></a></span>
<span id="cb160-9"><a href="filling-gaps-in-temperature-records.html#cb160-9" tabindex="-1"></a>eval_table[,<span class="st">&quot;RMSEP&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">RMSEP</span>(option1, observed),</span>
<span id="cb160-10"><a href="filling-gaps-in-temperature-records.html#cb160-10" tabindex="-1"></a>                                <span class="fu">RMSEP</span>(option2, observed),</span>
<span id="cb160-11"><a href="filling-gaps-in-temperature-records.html#cb160-11" tabindex="-1"></a>                                <span class="fu">RMSEP</span>(option3, observed),</span>
<span id="cb160-12"><a href="filling-gaps-in-temperature-records.html#cb160-12" tabindex="-1"></a>                                <span class="fu">RMSEP</span>(option4, observed)),</span>
<span id="cb160-13"><a href="filling-gaps-in-temperature-records.html#cb160-13" tabindex="-1"></a>                              <span class="dv">1</span>)</span>
<span id="cb160-14"><a href="filling-gaps-in-temperature-records.html#cb160-14" tabindex="-1"></a></span>
<span id="cb160-15"><a href="filling-gaps-in-temperature-records.html#cb160-15" tabindex="-1"></a>eval_table[,<span class="st">&quot;RPIQ&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fu">RPIQ</span>(option1, observed),</span>
<span id="cb160-16"><a href="filling-gaps-in-temperature-records.html#cb160-16" tabindex="-1"></a>                               <span class="fu">RPIQ</span>(option2, observed),</span>
<span id="cb160-17"><a href="filling-gaps-in-temperature-records.html#cb160-17" tabindex="-1"></a>                               <span class="fu">RPIQ</span>(option3, observed),</span>
<span id="cb160-18"><a href="filling-gaps-in-temperature-records.html#cb160-18" tabindex="-1"></a>                               <span class="fu">RPIQ</span>(option4, observed)),</span>
<span id="cb160-19"><a href="filling-gaps-in-temperature-records.html#cb160-19" tabindex="-1"></a>                             <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="filling-gaps-in-temperature-records.html#cb161-1" tabindex="-1"></a>eval_table</span></code></pre></div>
<table class="table table-striped" style="font-size: 10px; ">
<thead>
<tr>
<th style="text-align:right;">
Option
</th>
<th style="text-align:left;">
Input_data
</th>
<th style="text-align:left;">
Interpolation_method
</th>
<th style="text-align:right;">
RMSEP
</th>
<th style="text-align:right;">
RPIQ
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
daily
</td>
<td style="text-align:left;">
from proxy
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
4.2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
daily
</td>
<td style="text-align:left;">
local extremes
</td>
<td style="text-align:right;">
1.9
</td>
<td style="text-align:right;">
5.7
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
2.7
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
hourly interpolation
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
7.2
</td>
</tr>
</tbody>
</table>
<p>The relative performance of the methods on the whole dataset is quite similar to the previous assessment. The quality of the proxy-based idealized temperature curves went down slightly, while all other approaches saw improvements in quality (lower RMSEP and higher RPIQ). The RPIQ values for the two interpolations that were based on local data (options 2 and 4) are very high, especially for option 4, which used the <code>interpolate_gaps_hourly</code> function. The RPIQ score for this option almost exceeds the ‘excellence’ threshold for the most conservative RPIQ evaluation scheme that I’ve come across (8). I find this quite remarkable, given the variable nature of daily temperature fluctuations and the fact that about half of the actually recorded values were removed before running the interpolation.</p>
<p><strong><em>In conclusion, the <code>interpolate_gaps_hourly</code> function provided a very good approximation of hourly temperatures for times when no values were recorded.</em></strong></p>
</div>
<div id="computing-agroclimatic-metrics" class="section level3 hasAnchor" number="11.4.2">
<h3><span class="header-section-number">11.4.2</span> Computing agroclimatic metrics<a href="filling-gaps-in-temperature-records.html#computing-agroclimatic-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, let’s look at the implication of the choice of interpolation method on chill and heat estimates. If we’re interested in using the Dynamic Model for winter chill or the Growing Degree Hours model for heat, we can simply calculate this using the <code>Dynamic_Model</code> and <code>GDH()</code> functions in <code>chillR</code>. For more functionality, see the <code>chilling()</code> and particularly the <code>tempResponse()</code> functions.</p>
<p>Let’s first look at the implications of method choice on chill accumulation:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="filling-gaps-in-temperature-records.html#cb162-1" tabindex="-1"></a>all_chill <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">DATE =</span> inter<span class="sc">$</span>DATE,</span>
<span id="cb162-2"><a href="filling-gaps-in-temperature-records.html#cb162-2" tabindex="-1"></a>                        <span class="st">&quot;Obs&quot;</span> <span class="ot">=</span> <span class="fu">Dynamic_Model</span>(observed),</span>
<span id="cb162-3"><a href="filling-gaps-in-temperature-records.html#cb162-3" tabindex="-1"></a>                        <span class="st">&quot;Opt1&quot;</span> <span class="ot">=</span> <span class="fu">Dynamic_Model</span>(option1),</span>
<span id="cb162-4"><a href="filling-gaps-in-temperature-records.html#cb162-4" tabindex="-1"></a>                        <span class="st">&quot;Opt2&quot;</span> <span class="ot">=</span> <span class="fu">Dynamic_Model</span>(option2),</span>
<span id="cb162-5"><a href="filling-gaps-in-temperature-records.html#cb162-5" tabindex="-1"></a>                        <span class="st">&quot;Opt3&quot;</span> <span class="ot">=</span> <span class="fu">Dynamic_Model</span>(option3),</span>
<span id="cb162-6"><a href="filling-gaps-in-temperature-records.html#cb162-6" tabindex="-1"></a>                        <span class="st">&quot;Opt4&quot;</span> <span class="ot">=</span> <span class="fu">Dynamic_Model</span>(option4))</span>
<span id="cb162-7"><a href="filling-gaps-in-temperature-records.html#cb162-7" tabindex="-1"></a></span>
<span id="cb162-8"><a href="filling-gaps-in-temperature-records.html#cb162-8" tabindex="-1"></a>all_chill <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(all_chill, Obs<span class="sc">:</span>Opt4)</span>
<span id="cb162-9"><a href="filling-gaps-in-temperature-records.html#cb162-9" tabindex="-1"></a></span>
<span id="cb162-10"><a href="filling-gaps-in-temperature-records.html#cb162-10" tabindex="-1"></a>all_chill[<span class="fu">which</span>(all_chill<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Obs&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span> </span>
<span id="cb162-11"><a href="filling-gaps-in-temperature-records.html#cb162-11" tabindex="-1"></a>  <span class="st">&quot;Observed temperatures&quot;</span></span>
<span id="cb162-12"><a href="filling-gaps-in-temperature-records.html#cb162-12" tabindex="-1"></a>all_chill[<span class="fu">which</span>(all_chill<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt1&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span> </span>
<span id="cb162-13"><a href="filling-gaps-in-temperature-records.html#cb162-13" tabindex="-1"></a>  <span class="st">&quot;Option 1 - idealized record from proxy data&quot;</span></span>
<span id="cb162-14"><a href="filling-gaps-in-temperature-records.html#cb162-14" tabindex="-1"></a>all_chill[<span class="fu">which</span>(all_chill<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt2&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb162-15"><a href="filling-gaps-in-temperature-records.html#cb162-15" tabindex="-1"></a>  <span class="st">&quot;Option 2 - idealized record from daily orchard data&quot;</span></span>
<span id="cb162-16"><a href="filling-gaps-in-temperature-records.html#cb162-16" tabindex="-1"></a>all_chill[<span class="fu">which</span>(all_chill<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt3&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb162-17"><a href="filling-gaps-in-temperature-records.html#cb162-17" tabindex="-1"></a>  <span class="st">&quot;Option 3 - linear interpolation of hourly data&quot;</span></span>
<span id="cb162-18"><a href="filling-gaps-in-temperature-records.html#cb162-18" tabindex="-1"></a>all_chill[<span class="fu">which</span>(all_chill<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt4&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb162-19"><a href="filling-gaps-in-temperature-records.html#cb162-19" tabindex="-1"></a>  <span class="st">&quot;Option 4 - use of interpolate_gaps_hourly&quot;</span></span></code></pre></div>
<pre><code>## Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2
## 3.5.0.
## ℹ Please use the `legend.position.inside` argument of `theme()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="Book_files/figure-html/chill_accumulation-1.png" width="672" /></p>
<p>This figure shows that chill accumulation differed substantially between the options. Both the use of proxy data and the use of linear interpolation of hourly temperatures led to considerable overestimation of chill accumulation.</p>
<p>Here is the same assessment for heat:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="filling-gaps-in-temperature-records.html#cb164-1" tabindex="-1"></a>all_heat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">DATE =</span> inter<span class="sc">$</span>DATE,</span>
<span id="cb164-2"><a href="filling-gaps-in-temperature-records.html#cb164-2" tabindex="-1"></a>                       <span class="st">&quot;Obs&quot;</span> <span class="ot">=</span> <span class="fu">GDH</span>(observed),</span>
<span id="cb164-3"><a href="filling-gaps-in-temperature-records.html#cb164-3" tabindex="-1"></a>                       <span class="st">&quot;Opt1&quot;</span> <span class="ot">=</span> <span class="fu">GDH</span>(option1),</span>
<span id="cb164-4"><a href="filling-gaps-in-temperature-records.html#cb164-4" tabindex="-1"></a>                       <span class="st">&quot;Opt2&quot;</span> <span class="ot">=</span> <span class="fu">GDH</span>(option2),</span>
<span id="cb164-5"><a href="filling-gaps-in-temperature-records.html#cb164-5" tabindex="-1"></a>                       <span class="st">&quot;Opt3&quot;</span> <span class="ot">=</span> <span class="fu">GDH</span>(option3),</span>
<span id="cb164-6"><a href="filling-gaps-in-temperature-records.html#cb164-6" tabindex="-1"></a>                       <span class="st">&quot;Opt4&quot;</span> <span class="ot">=</span> <span class="fu">GDH</span>(option4))</span>
<span id="cb164-7"><a href="filling-gaps-in-temperature-records.html#cb164-7" tabindex="-1"></a></span>
<span id="cb164-8"><a href="filling-gaps-in-temperature-records.html#cb164-8" tabindex="-1"></a>all_heat <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(all_heat, Obs<span class="sc">:</span>Opt4)</span>
<span id="cb164-9"><a href="filling-gaps-in-temperature-records.html#cb164-9" tabindex="-1"></a></span>
<span id="cb164-10"><a href="filling-gaps-in-temperature-records.html#cb164-10" tabindex="-1"></a>all_heat[<span class="fu">which</span>(all_heat<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Obs&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb164-11"><a href="filling-gaps-in-temperature-records.html#cb164-11" tabindex="-1"></a>  <span class="st">&quot;Observed temperatures&quot;</span></span>
<span id="cb164-12"><a href="filling-gaps-in-temperature-records.html#cb164-12" tabindex="-1"></a>all_heat[<span class="fu">which</span>(all_heat<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt1&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb164-13"><a href="filling-gaps-in-temperature-records.html#cb164-13" tabindex="-1"></a>  <span class="st">&quot;Option 1 - idealized record from proxy data&quot;</span></span>
<span id="cb164-14"><a href="filling-gaps-in-temperature-records.html#cb164-14" tabindex="-1"></a>all_heat[<span class="fu">which</span>(all_heat<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt2&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb164-15"><a href="filling-gaps-in-temperature-records.html#cb164-15" tabindex="-1"></a>  <span class="st">&quot;Option 2 - idealized record from daily orchard data&quot;</span></span>
<span id="cb164-16"><a href="filling-gaps-in-temperature-records.html#cb164-16" tabindex="-1"></a>all_heat[<span class="fu">which</span>(all_heat<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt3&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb164-17"><a href="filling-gaps-in-temperature-records.html#cb164-17" tabindex="-1"></a>  <span class="st">&quot;Option 3 - linear interpolation of hourly data&quot;</span></span>
<span id="cb164-18"><a href="filling-gaps-in-temperature-records.html#cb164-18" tabindex="-1"></a>all_heat[<span class="fu">which</span>(all_heat<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Opt4&quot;</span>),<span class="st">&quot;Method&quot;</span>] <span class="ot">&lt;-</span></span>
<span id="cb164-19"><a href="filling-gaps-in-temperature-records.html#cb164-19" tabindex="-1"></a>  <span class="st">&quot;Option 4 - use of interpolate_gaps_hourly&quot;</span></span></code></pre></div>
<p><img src="Book_files/figure-html/heat_accumulation-1.png" width="672" /></p>
<p>This comparison doesn’t look quite as bad as for chill accumulation, but also here, option 4 clearly provided the most accurate estimate (it almost coincides with the black line, making the difference hard to see).</p>
<p>This dataset didn’t cover the winter season, so the chill numbers aren’t too meaningful, but it is nevertheless instructive to compare the total accumulation of chill and heat over the whole temperature record:</p>
<table class="table table-striped" style="font-size: 10px; ">
<thead>
<tr>
<th style="text-align:right;">
Option
</th>
<th style="text-align:left;">
Input_data
</th>
<th style="text-align:left;">
Interpolation_method
</th>
<th style="text-align:right;">
Chill Portions
</th>
<th style="text-align:right;">
Growing Degree Hours
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
observed
</td>
<td style="text-align:left;">
none
</td>
<td style="text-align:right;">
12.2
</td>
<td style="text-align:right;">
72925
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
daily
</td>
<td style="text-align:left;">
from proxy
</td>
<td style="text-align:right;">
20.1
</td>
<td style="text-align:right;">
64813
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
daily
</td>
<td style="text-align:left;">
local extremes
</td>
<td style="text-align:right;">
13.8
</td>
<td style="text-align:right;">
70974
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
linear
</td>
<td style="text-align:right;">
23.1
</td>
<td style="text-align:right;">
78256
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
hourly
</td>
<td style="text-align:left;">
hourly interpolation
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
72610
</td>
</tr>
</tbody>
</table>
<p>This comparison shows that the choice of interpolation method can have substantial impact on our impression of accumulated chill and heat. The <code>interpolate_gaps_hourly()</code> function in <code>chillR</code> outperformed all other methods evaluated here.</p>
</div>
</div>
<div id="exercises_patching" class="section level2 unnumbered hasAnchor">
<h2><code>Exercises</code> on filling gaps<a href="filling-gaps-in-temperature-records.html#exercises_patching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please document all results of the following assignments in your <code>learning logbook</code>.</p>
<ul>
<li>You already downloaded some weather data in the exercises for the <a href="get_temp_data.html#get_temp_data">Getting temperatures lesson</a>. You can keep working with this.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Use <code>chillR</code> functions to find out how many gaps you have in this dataset (even if you have none, please still follow all further steps)</li>
<li>Create a list of the 25 closest weather stations using the <code>handle_gsod</code> function</li>
<li>Identify suitable weather stations for patching gaps</li>
<li>Download weather data for promising stations, convert them to <code>chillR</code> format and compile them in a list</li>
<li>Use the <code>patch_daily_temperatures</code> function to fill gaps</li>
<li>Investigate the results - have all gaps been filled?</li>
<li>If necessary, repeat until you have a dataset you can work with in further analyses</li>
</ol>

</div>
</div>
<h3>References<a href="refs.html#refs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="1" line-spacing="2">
<div id="ref-linvill1990calculating" class="csl-entry">
Linvill DE. (1990). Calculating chilling hours and chill units from daily maximum and minimum temperature observations. <em>HortScience</em>, <em>25</em>(1), 14–16. doi: <a href="https://doi.org/10.21273/HORTSCI.25.1.14">10.21273/HORTSCI.25.1.14</a>
</div>
<div id="ref-luedeling_interpolating_2018" class="csl-entry">
Luedeling E. (2018). Interpolating hourly temperatures for computing agroclimatic metrics. <em>International Journal of Biometeorology</em>, <em>62</em>(10), 1799–1807. doi: <a href="https://doi.org/10.1007/s00484-018-1582-7">10.1007/s00484-018-1582-7</a>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="get_temp_data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generating-temperature-scenarios.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Book.pdf", "Book.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
